(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70486,e=>{"use strict";e.i(47167);var t,r=e.i(43476),i=e.i(932),o=e.i(18566),n=e.i(57801),a=e.i(6376),l=e.i(71645);let s=["white","black"],c=["a","b","c","d","e","f","g","h"],u=["1","2","3","4","5","6","7","8"],h=[...u].reverse(),d=c.flatMap(e=>u.map(t=>e+t)),p=e=>e.every(e=>e>=0&&e<=7)?d[8*e[0]+e[1]]:void 0,f=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],g=d.map(f),m=d.map((e,t)=>({key:e,pos:g[t]}));function b(e){let t,r=()=>(void 0===t&&(t=e()),t);return r.clear=()=>{t=void 0},r}let v=e=>"white"===e?"black":"white",_=(e,t)=>(e[0]-t[0])**2+(e[1]-t[1])**2,w=(e,t)=>e.role===t.role&&e.color===t.color,y=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],k=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},C=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},x=(e,t)=>{e.style.visibility=t?"visible":"hidden"},S=e=>e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.targetTouches?.[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0,E=b(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(e=>navigator.userAgent.toLowerCase().includes(e))),M=e=>2===e.button&&!(e.ctrlKey&&E()),P=(e,t)=>{let r=document.createElement(e);return t&&(r.className=t),r};function A(e,t,r){let i=f(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[r.left+r.width*i[0]/8+r.width/16,r.top+r.height*(7-i[1])/8+r.height/16]}let T=(e,t)=>Math.abs(e-t),$=(e,t,r,i)=>T(e,r)*T(t,i)==2,I=(e,t,r,i)=>e===r!=(t===i),O=(e,t,r,i)=>T(e,r)===T(t,i)&&e!==r,L=e=>O(...e.orig.pos,...e.dest.pos),j=e=>I(...e.orig.pos,...e.dest.pos),R={pawn:e=>1>=T(e.orig.pos[0],e.dest.pos[0])&&(1===T(e.orig.pos[0],e.dest.pos[0])?e.dest.pos[1]===e.orig.pos[1]+("white"===e.color?1:-1):((e,t,r,i,o)=>{let n=o?1:-1;return e===r&&(i===t+n||i===t+2*n&&(o?t<=1:t>=6))})(...e.orig.pos,...e.dest.pos,"white"===e.color)),knight:e=>$(...e.orig.pos,...e.dest.pos),bishop:L,rook:j,queen:e=>L(e)||j(e),king:e=>((e,t,r,i)=>1===Math.max(T(e,r),T(t,i)))(...e.orig.pos,...e.dest.pos)||e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===7*("white"!==e.color)&&(4===e.orig.pos[0]&&(2===e.dest.pos[0]&&e.rookFilesFriendlies.includes(0)||6===e.dest.pos[0]&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0]))};function N(e,t){let r=e.pieces,i=r.get(t);if(!i||i.color===e.turnColor)return[];let o=i.color,n=new Map([...r].filter(([e,t])=>t.color===o)),a=new Map([...r].filter(([e,t])=>t.color===v(o))),l={orig:{key:t,pos:f(t)},role:i.role,allPieces:r,friendlies:n,enemies:a,color:o,rookFilesFriendlies:Array.from(r).filter(([e,t])=>e[1]===("white"===o?"1":"8")&&t.color===o&&"rook"===t.role).map(([e])=>f(e)[0]),lastMove:e.lastMove};return m.filter(t=>{let r;return r={...l,dest:t},R[i.role](r)&&e.premovable.additionalPremoveRequirements(r)}).map(e=>e.key)}function q(e,...t){e&&setTimeout(()=>e(...t),1)}function K(e){e.premovable.current&&(e.premovable.current=void 0,q(e.premovable.events.unset))}function D(e){let t=e.predroppable;t.current&&(t.current=void 0,q(t.events.unset))}function F(e,t,r){let i=e.pieces.get(t),o=e.pieces.get(r);if(t===r||!i)return!1;let n=o&&o.color!==i.color?o:void 0;return r===e.selected&&G(e),q(e.events.move,t,r,n),!function(e,t,r){if(!e.autoCastle)return!1;let i=e.pieces.get(t);if(!i||"king"!==i.role)return!1;let o=f(t),n=f(r);if(0!==o[1]&&7!==o[1]||o[1]!==n[1])return!1;4!==o[0]||e.pieces.has(r)||(6===n[0]?r=p([7,n[1]]):2===n[0]&&(r=p([0,n[1]])));let a=e.pieces.get(r);return!!a&&a.color===i.color&&"rook"===a.role&&((e.pieces.delete(t),e.pieces.delete(r),o[0]<n[0])?(e.pieces.set(p([6,n[1]]),i),e.pieces.set(p([5,n[1]]),a)):(e.pieces.set(p([2,n[1]]),i),e.pieces.set(p([3,n[1]]),a)),!0)}(e,t,r)&&(e.pieces.set(r,i),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,q(e.events.change),n||!0}function B(e,t,r,i){if(e.pieces.has(r))if(!i)return!1;else e.pieces.delete(r);return q(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,q(e.events.change),e.movable.dests=void 0,e.turnColor=v(e.turnColor),!0}function z(e,t,r){let i=F(e,t,r);return i&&(e.movable.dests=void 0,e.turnColor=v(e.turnColor),e.animation.current=void 0),i}function W(e,t,r){if(X(e,t,r)){let i=z(e,t,r);if(i){let o=e.hold.stop();G(e);let n={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==i&&(n.captured=i),q(e.movable.events.after,t,r,n),!0}}else if(Y(e,t,r)){var i;return i={ctrlKey:e.stats.ctrlKey},D(e),e.premovable.current=[t,r],q(e.premovable.events.set,t,r,i),G(e),!0}return G(e),!1}function U(e,t,r,i){var o,n,a,l,s,c,u;let h,d=e.pieces.get(t);if(d&&(o=e,n=t,a=r,(h=o.pieces.get(n))&&(n===a||!o.pieces.has(a))&&("both"===o.movable.color||o.movable.color===h.color&&o.turnColor===h.color)||i))e.pieces.delete(t),B(e,d,r,i),q(e.movable.events.afterNewPiece,d.role,r,{premove:!1,predrop:!1});else{let i,o;if(d&&(l=e,s=t,c=r,i=l.pieces.get(s),o=l.pieces.get(c),i&&(!o||o.color!==l.movable.color)&&l.predroppable.enabled&&("pawn"!==i.role||"1"!==c[1]&&"8"!==c[1])&&l.movable.color===i.color&&l.turnColor!==i.color)){u=d.role,K(e),e.predroppable.current={role:u,key:r},q(e.predroppable.events.set,u,r)}else K(e),D(e)}e.pieces.delete(t),G(e)}function H(e,t,r){if(q(e.events.select,t),e.selected)if(e.selected!==t||e.draggable.enabled){if((e.selectable.enabled||r)&&e.selected!==t&&W(e,e.selected,t)){e.stats.dragged=!1;return}}else{G(e),e.hold.cancel();return}(e.selectable.enabled||e.draggable.enabled)&&(Q(e,t)||Z(e,t))&&(V(e,t),e.hold.start())}function V(e,t){e.selected=t,Z(e,t)?e.premovable.customDests||(e.premovable.dests=N(e,t)):e.premovable.dests=void 0}function G(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Q(e,t){let r=e.pieces.get(t);return!!r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}let X=(e,t,r)=>t!==r&&Q(e,t)&&(e.movable.free||!!e.movable.dests?.get(t)?.includes(r));function Z(e,t){let r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}let Y=(e,t,r)=>t!==r&&Z(e,t)&&(e.premovable.customDests?.get(t)??N(e,t)).includes(r);function J(e){let t=e.premovable.current;if(!t)return!1;let r=t[0],i=t[1],o=!1;if(X(e,r,i)){let t=z(e,r,i);if(t){let n={premove:!0};!0!==t&&(n.captured=t),q(e.movable.events.after,r,i,n),o=!0}}return K(e),o}function ee(e){K(e),D(e),G(e)}function et(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ee(e)}function er(e,t,r){let i=Math.floor(8*(e[0]-r.left)/r.width);t||(i=7-i);let o=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(o=7-o),i>=0&&i<8&&o>=0&&o<8?p([i,o]):void 0}let ei="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",eo={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},en={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function ea(e){"start"===e&&(e=ei);let t=new Map,r=7,i=0;for(let o of e)switch(o){case" ":case"[":return t;case"/":if(--r<0)return t;i=0;break;case"~":{let e=p([i-1,r]),o=e&&t.get(e);o&&(o.promoted=!0);break}default:{let e=o.charCodeAt(0);if(e<57)i+=e-48;else{let e=o.toLowerCase(),n=p([i,r]);n&&t.set(n,{role:eo[e],color:o===e?"black":"white"}),++i}}}return t}function el(e,t){t.animation&&(ec(e.animation,t.animation),70>(e.animation.duration||0)&&(e.animation.enabled=!1))}function es(e,t){if(t.movable?.dests&&(e.movable.dests=void 0),t.drawable?.autoShapes&&(e.drawable.autoShapes=[]),ec(e,t),t.fen&&(e.pieces=ea(t.fen),e.drawable.shapes=t.drawable?.shapes||[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(let[r,i]of e.pieces)"king"===i.role&&i.color===t&&(e.check=r)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&V(e,e.selected),el(e,t),!e.movable.rookCastle&&e.movable.dests){let t="white"===e.movable.color?"1":"8",r="e"+t,i=e.movable.dests.get(r),o=e.pieces.get(r);i&&o&&"king"===o.role&&e.movable.dests.set(r,i.filter(e=>!(e==="a"+t&&i.includes("c"+t))&&!(e==="h"+t&&i.includes("g"+t))))}}function ec(e,t){for(let r in t)"__proto__"!==r&&"constructor"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)&&eu(e[r])&&eu(t[r])?ec(e[r],t[r]):e[r]=t[r])}function eu(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}let eh=(e,t)=>t.animation.enabled?function(e,t){let r=new Map(t.pieces),i=e(t),o=function(e,t){let r,i,o,n=new Map,a=[],l=new Map,s=[],c=[],u=new Map;for(let[t,r]of e)u.set(t,ep(t,r));for(let e of d)r=t.pieces.get(e),i=u.get(e),r?i?w(r,i.piece)||(s.push(i),c.push(ep(e,r))):c.push(ep(e,r)):i&&s.push(i);for(let e of c)(i=ef(e,s.filter(t=>w(e.piece,t.piece))))&&(o=[i.pos[0]-e.pos[0],i.pos[1]-e.pos[1]],n.set(e.key,o.concat(o)),a.push(i.key));for(let e of s)a.includes(e.key)||l.set(e.key,e.piece);return{anims:n,fadings:l}}(r,t);if(o.anims.size||o.fadings.size){let e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},e||function e(t,r){let i=t.animation.current;if(void 0===i){t.dom.destroyed||t.dom.redrawNow();return}let o=1-(r-i.start)*i.frequency;if(o<=0)t.animation.current=void 0,t.dom.redrawNow();else{let r=eg(o);for(let e of i.plan.anims.values())e[2]=e[0]*r,e[3]=e[1]*r;t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>e(t,r))}}(t,performance.now())}else t.dom.redraw();return i}(e,t):ed(e,t);function ed(e,t){let r=e(t);return t.dom.redraw(),r}let ep=(e,t)=>({key:e,pos:f(e),piece:t}),ef=(e,t)=>t.sort((t,r)=>_(e.pos,t.pos)-_(e.pos,r.pos))[0],eg=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,em=["green","red","blue","yellow"];function eb(e,t){e.drawable.current&&(e.drawable.current.pos=S(t))}function ev(e){let t=e.drawable.current;t&&(t.mouseSq&&function(e,t){let r=e.shapes.find(e=>ew(e,t));r&&(e.shapes=e.shapes.filter(e=>!ew(e,t))),r&&r.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),ey(e)}(e.drawable,t),e_(e))}function e_(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}let ew=(e,t)=>e.orig===t.orig&&e.dest===t.dest;function ey(e){e.onChange&&e.onChange(e.shapes)}function ek(e){requestAnimationFrame(()=>{let t=e.draggable.current;if(!t)return;e.animation.current?.plan.anims.has(t.orig)&&(e.animation.current=void 0);let r=e.pieces.get(t.orig);if(r&&w(r,t.piece)){if(!t.started&&_(t.pos,t.origPos)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){let e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),t.element=e}let r=e.dom.bounds();k(t.element,[t.pos[0]-r.left-r.width/16,t.pos[1]-r.top-r.height/16]),t.keyHasChanged||(t.keyHasChanged=t.orig!==er(t.pos,"white"===e.orientation,r))}}else eS(e);ek(e)})}function eC(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=S(t))}function ex(e,t){let r=e.draggable.current;if(!r)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}K(e),D(e);let i=er(S(t)||r.pos,"white"===e.orientation,e.dom.bounds());i&&r.started&&r.orig!==i?r.newPiece?U(e,r.orig,i,r.force):(e.stats.ctrlKey=t.ctrlKey,W(e,r.orig,i)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(r.orig),q(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===i||!i)?G(e):e.selectable.enabled||G(e),eE(e),e.draggable.current=void 0,e.dom.redraw()}function eS(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,G(e),eE(e),e.dom.redraw())}function eE(e){let t=e.dom.elements;t.ghost&&x(t.ghost,!1)}function eM(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}function eP(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function eA({orig:e,dest:t,brush:r,piece:i,modifiers:o,customSvg:n,label:a,below:l},s,c,u,h){var d,p;return[u.width,u.height,c,h&&"pendingErase",e,t,r,s&&"-",i&&[(d=i).color,d.role,d.scale].filter(e=>e).join(","),o&&[(p=o).lineWidth,p.hilite].filter(e=>e).join(","),n&&`custom-${eT(n.html)},${n.center?.[0]??"o"}`,a&&`label-${eT(a.text)}`,l&&"below"].filter(e=>e).join(",")}function eT(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function e$(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function eI(e,t){return!0===(e&&t.has(e)&&t.get(e).size>1)}function eO(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function eL(e,t){for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function ej(e,t){return t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(e=>e).join("")}:e}function eR(e){let t=e.modifiers?.hilite;return{key:t&&`hilite-${t.replace("#","")}`,color:t}}function eN(e,t,r){return(e.opacity||1)*(r?.6:t?.9:1)}function eq(e,t){let r=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*i]}function eK(e,t,r=!0){let i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(8*i/Math.PI)+16)%16:i}function eD(e,t,r){let i=Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((e,t)=>e+t*t,0)),o=eK(e,t,!1);if(r&&(i-=33/64,r.size>1)){i-=10/64;let o=eK(e,t);(r.has((o+1)%16)||r.has((o+15)%16))&&1&o&&(i-=.4)}return[e[0]-Math.cos(o)*i,e[1]-Math.sin(o)*i].map(e=>e+.5)}function eF(e,t){let r,i,o=eL(eO("svg"),{class:e,viewBox:t?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return t&&o.appendChild((r=eO("defs"),(i=eL(eO("filter"),{id:"cg-filter-blur"})).appendChild(eL(eO("feGaussianBlur"),{stdDeviation:"0.013"})),r.appendChild(i),r)),o.appendChild(eO("g")),o}function eB(e,t){let r,i=P("coords",t);for(let t of e)(r=P("coord")).textContent=t,i.appendChild(r);return i}function ez(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}let eW=(e,t,r)=>i=>{e.drawable.current?e.drawable.enabled&&r(e,i):e.viewOnly||t(e,i)};function eU(e){let t=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,i=t.height/t.width,o=8*Math.floor(t.width*window.devicePixelRatio/8)/window.devicePixelRatio,n=o*i;r.style.width=o+"px",r.style.height=n+"px",e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",o+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",n+"px")}let eH=e=>"PIECE"===e.tagName,eV=e=>"SQUARE"===e.tagName;function eG(e,t){for(let r of t)e.dom.elements.board.removeChild(r)}function eQ(e,t){let r=e[1];return`${t?10-r:3+r}`}let eX=e=>`${e.color} ${e.role}`,eZ=(e,t)=>e.lastMove?.[1]&&!e.pieces.has(e.lastMove[1])&&"e"===e.lastMove[0][0]&&["h","a"].includes(e.lastMove[1][0])&&e.lastMove[0][1]===e.lastMove[1][1]&&((e,t,r,i)=>{let o=r-e,n=i-t;if(o&&n&&Math.abs(o)!==Math.abs(n))return[];let a=Math.sign(o),l=Math.sign(n),s=[],c=e+a,u=t+l;for(;c!==r||u!==i;)s.push([c,u]),c+=a,u+=l;return s.map(p).filter(e=>void 0!==e)})(...f(e.lastMove[0]),...f(e.lastMove[1])).some(t=>e.pieces.has(t))?(t>e.lastMove[0]?"g":"c")+t[1]:t;function eY(e,t,r){let i=e.get(t);i?e.set(t,`${i} ${r}`):e.set(t,r)}function eJ(e,t,r){let i=e.get(t);i?i.push(r):e.set(t,[r])}function e0(e,t,r,i){var o=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(o,e0.prototype),o.expected=t,o.found=r,o.location=i,o.name="SyntaxError",o}function e1(){this.constructor=e0}function e2(e,t,r){return(r=r||" ",e.length>t)?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function e6(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function e8(e,t){return e*t&0xffffffffffffffffn}e1.prototype=Error.prototype,e0.prototype=new e1,e0.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,i=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){i=e[r].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,n=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(o):o,a=this.location.source+":"+n.line+":"+n.column;if(i){var l=this.location.end,s=e2("",n.line.toString().length," "),c=i[o.line-1],u=(o.line===l.line?l.column:c.length+1)-o.column||1;t+="\n --> "+a+"\n"+s+" |\n"+n.line+" | "+c+"\n"+s+" | "+e2("",o.column-1," ")+e2("",u,"^")}else t+="\n at "+a}return t},e0.buildMessage=function(e,t){var r={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t=e.parts.map(function(e){return Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)});return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=e.map(a);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+(t?'"'+o(t)+'"':"end of input")+" found."};let e4=(t=0xa187eb39cdcaed8f31c4b365b102e01en,function(){let e=BigInt(0xffffffffffffffffn&t),r=BigInt(t>>64n&0xffffffffffffffffn),i=e8(e6(e8(e,5n),7n),9n);return r^=e,e=(e6(e,24n)^r^r<<16n)&0xffffffffffffffffn,t=(r=e6(r,37n))<<64n|e,i}),e3=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>e4()))),e5=Array.from({length:8},()=>e4()),e7=Array.from({length:16},()=>e4()),e9=e4(),te="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class tt{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:r,piece:i,from:o,to:n,flags:a,captured:l,promotion:s}=t,c=tb(o),u=tb(n);for(const o in this.color=r,this.piece=i,this.from=c,this.to=u,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=c+u,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="",ti)ti[o]&a&&(this.flags+=tr[o]);l&&(this.captured=l),s&&(this.promotion=s,this.lan+=s)}isCapture(){return this.flags.indexOf(tr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(tr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(tr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(tr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(tr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(tr.BIG_PAWN)>-1}}let tr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},ti={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},to={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},tn={...to,WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},ta={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},tl={b:[16,32,17,15],w:[-16,-32,-17,-15]},ts={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},tc=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],tu=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],th={p:1,n:2,b:4,r:8,q:16,k:32},td=["n","b","r","q"],tp={k:ti.KSIDE_CASTLE,q:ti.QSIDE_CASTLE},tf={w:[{square:ta.a1,flag:ti.QSIDE_CASTLE},{square:ta.h1,flag:ti.KSIDE_CASTLE}],b:[{square:ta.a8,flag:ti.QSIDE_CASTLE},{square:ta.h8,flag:ti.KSIDE_CASTLE}]},tg={b:1,w:6};function tm(e){return -1!=="0123456789".indexOf(e)}function tb(e){let t=15&e,r=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function tv(e){return"w"===e?"b":"w"}function t_(e,t,r,i,o,n,a=ti.NORMAL){let l=i>>4;if("p"===o&&(7===l||0===l))for(let l=0;l<td.length;l++){let s=td[l];e.push({color:t,from:r,to:i,piece:o,captured:n,promotion:s,flags:a|ti.PROMOTION})}else e.push({color:t,from:r,to:i,piece:o,captured:n,flags:a})}function tw(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}function ty(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class tk{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=te,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...tn},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:r=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6&&(e=i.concat(["-","-","0","1"].slice(-(6-i.length))).join(" ")),i=e.split(/\s+/),!t){let{ok:t,error:r}=function(e){let t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let r=parseInt(t[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let i=parseInt(t[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let o=t[0].split("/");if(8!==o.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<o.length;e++){let t=0,r=!1;for(let i=0;i<o[e].length;i++)if(tm(o[e][i])){if(r)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(o[e][i],10),r=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[e][i]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,r=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:e,regex:r}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!r.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(r)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(o[0]+o[7]).some(e=>"P"===e.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw Error(r)}let o=i[0],n=0;this.clear({preserveHeaders:r});for(let e=0;e<o.length;e++){let t=o.charAt(e);if("/"===t)n+=8;else if(tm(t))n+=parseInt(t,10);else{let e=t<"a"?"w":"b";this._put({type:t.toLowerCase(),color:e},tb(n)),n++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=ti.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=ti.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=ti.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=ti.QSIDE_CASTLE),this._epSquare="-"===i[3]?-1:ta[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,r="";for(let e=ta.a8;e<=ta.h1;e++){if(this._board[e]){t>0&&(r+=t,t=0);let{color:i,type:o}=this._board[e];r+="w"===i?o.toUpperCase():o.toLowerCase()}else t++;e+1&136&&(t>0&&(r+=t),e!==ta.h1&&(r+="/"),t=0,e+=8)}let i="";this._castling.w&ti.KSIDE_CASTLE&&(i+="K"),this._castling.w&ti.QSIDE_CASTLE&&(i+="Q"),this._castling.b&ti.KSIDE_CASTLE&&(i+="k"),this._castling.b&ti.QSIDE_CASTLE&&(i+="q"),i=i||"-";let o="-";if(-1!==this._epSquare)if(e)o=tb(this._epSquare);else{let e=this._epSquare+("w"===this._turn?16:-16);for(let t of[e+1,e-1]){if(136&t)continue;let e=this._turn;if(this._board[t]?.color===e&&this._board[t]?.type==="p"){this._makeMove({color:e,from:t,to:this._epSquare,piece:"p",captured:"p",flags:ti.EP_CAPTURE});let r=!this._isKingAttacked(e);if(this._undoMove(),r){o=tb(this._epSquare);break}}}}return[r,this._turn,i,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;let{color:t,type:r}=this._board[e];return e3[({w:0,b:1})[t]][({p:0,n:1,b:2,r:3,q:4,k:5})[r]][e]}_epKey(){return -1===this._epSquare?0n:e5[7&this._epSquare]}_castlingKey(){return e7[this._castling.w>>5|this._castling.b>>3]}_computeHash(){let e=0n;for(let t=ta.a8;t<=ta.h1;t++){if(136&t){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),"b"===this._turn&&(e^=e9),e}_updateSetup(e){this._history.length>0||(e!==te?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(te)}get(e){return this._board[ta[e]]}findPiece(e){let t=[];for(let r=ta.a8;r<=ta.h1;r++){if(136&r){r+=7;continue}this._board[r]&&this._board[r]?.color===e.color&&this._board[r].color===e.color&&this._board[r].type===e.type&&t.push(tb(r))}return t}put({type:e,color:t},r){return!!this._put({type:e,color:t},r)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},r){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase())||!(r in ta))return!1;let i=ta[r];if("k"==e&&-1!=this._kings[t]&&this._kings[t]!=i)return!1;let o=this._board[i];return o&&"k"===o.type&&(this._kings[o.color]=-1),this._set(i,{type:e,color:t}),"k"===e&&(this._kings[t]=i),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){let t=this.get(e);return this._clear(ta[e]),t&&"k"===t.type&&(this._kings[t.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();let e=this._board[ta.e1]?.type==="k"&&this._board[ta.e1]?.color==="w",t=this._board[ta.e8]?.type==="k"&&this._board[ta.e8]?.color==="b";e&&this._board[ta.a1]?.type==="r"&&this._board[ta.a1]?.color==="w"||(this._castling.w&=-65),e&&this._board[ta.h1]?.type==="r"&&this._board[ta.h1]?.color==="w"||(this._castling.w&=-33),t&&this._board[ta.a8]?.type==="r"&&this._board[ta.a8]?.color==="b"||(this._castling.b&=-65),t&&this._board[ta.h8]?.type==="r"&&this._board[ta.h8]?.color==="b"||(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(-1===this._epSquare)return;let e=this._epSquare+("w"===this._turn?-16:16),t=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[e]||null!==this._board[this._epSquare]||this._board[t]?.color!==tv(this._turn)||this._board[t]?.type!=="p"){this._hash^=this._epKey(),this._epSquare=-1;return}[t+1,t-1].some(e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type==="p")||(this._hash^=this._epKey(),this._epSquare=-1)}_attacked(e,t,r){let i=[];for(let o=ta.a8;o<=ta.h1;o++){if(136&o){o+=7;continue}if(void 0===this._board[o]||this._board[o].color!==e)continue;let n=this._board[o],a=o-t;if(0===a)continue;let l=a+119;if(tc[l]&th[n.type]){if("p"===n.type){if(a>0&&"w"===n.color||a<=0&&"b"===n.color)if(!r)return!0;else i.push(tb(o));continue}if("n"===n.type||"k"===n.type)if(!r)return!0;else{i.push(tb(o));continue}let e=tu[l],s=o+e,c=!1;for(;s!==t;){if(null!=this._board[s]){c=!0;break}s+=e}if(!c)if(!r)return!0;else{i.push(tb(o));continue}}}return!!r&&i}attackers(e,t){return t?this._attacked(t,ta[e],!0):this._attacked(this._turn,ta[e],!0)}_isKingAttacked(e){let t=this._kings[e];return -1!==t&&this._attacked(tv(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,ta[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],r=0,i=0;for(let o=ta.a8;o<=ta.h1;o++){if(i=(i+1)%2,136&o){o+=7;continue}let n=this._board[o];n&&(e[n.type]=n.type in e?e[n.type]+1:1,"b"===n.type&&t.push(i),r++)}if(2===r||3===r&&(1===e.b||1===e.n))return!0;if(r===e.b+2){let e=0,r=t.length;for(let i=0;i<r;i++)e+=t[i];if(0===e||e===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:r}={}){let i=this._moves({square:t,piece:r});return e?i.map(e=>new tt(this,e)):i.map(e=>this._moveToSan(e,i))}_moves({legal:e=!0,piece:t,square:r}={}){let i=r?r.toLowerCase():void 0,o=t?.toLowerCase(),n=[],a=this._turn,l=tv(a),s=ta.a8,c=ta.h1,u=!1;if(i)if(!(i in ta))return[];else s=c=ta[i],u=!0;for(let e=s;e<=c;e++){let t;if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===l)continue;let{type:r}=this._board[e];if("p"===r){if(o&&o!==r)continue;t=e+tl[a][0],!this._board[t]&&(t_(n,a,e,t,"p"),t=e+tl[a][1],tg[a]!==e>>4||this._board[t]||t_(n,a,e,t,"p",void 0,ti.BIG_PAWN));for(let r=2;r<4;r++)136&(t=e+tl[a][r])||(this._board[t]?.color===l?t_(n,a,e,t,"p",this._board[t].type,ti.CAPTURE):t===this._epSquare&&t_(n,a,e,t,"p","p",ti.EP_CAPTURE))}else{if(o&&o!==r)continue;for(let i=0,o=ts[r].length;i<o;i++){let o=ts[r][i];for(t=e;!(136&(t+=o));){if(this._board[t]){if(this._board[t].color===a)break;t_(n,a,e,t,r,this._board[t].type,ti.CAPTURE);break}if(t_(n,a,e,t,r),"n"===r||"k"===r)break}}}}if((void 0===o||"k"===o)&&(!u||c===this._kings[a])){if(this._castling[a]&ti.KSIDE_CASTLE){let e=this._kings[a],t=e+2;this._board[e+1]||this._board[t]||this._attacked(l,this._kings[a])||this._attacked(l,e+1)||this._attacked(l,t)||t_(n,a,this._kings[a],t,"k",void 0,ti.KSIDE_CASTLE)}if(this._castling[a]&ti.QSIDE_CASTLE){let e=this._kings[a],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(l,this._kings[a])||this._attacked(l,e-1)||this._attacked(l,t)||t_(n,a,this._kings[a],t,"k",void 0,ti.QSIDE_CASTLE)}}if(!e||-1===this._kings[a])return n;let h=[];for(let e=0,t=n.length;e<t;e++)this._makeMove(n[e]),this._isKingAttacked(a)||h.push(n[e]),this._undoMove();return h}move(e,{strict:t=!1}={}){let r=null;if("string"==typeof e)r=this._moveFromSan(e,t);else if(null===e)r=this._moveFromSan("--",t);else if("object"==typeof e){let t=this._moves();for(let i=0,o=t.length;i<o;i++)if(e.from===tb(t[i].from)&&e.to===tb(t[i].to)&&(!("promotion"in t[i])||e.promotion===t[i].promotion)){r=t[i];break}}if(!r)if("string"==typeof e)throw Error(`Invalid move: ${e}`);else throw Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&r.flags&ti.NULL_MOVE)throw Error("Null move not allowed when in check");let i=new tt(this,r);return this._makeMove(r),this._incPositionCount(),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){let t=this._turn,r=tv(t);if(this._push(e),e.flags&ti.NULL_MOVE){"b"===t&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=-1;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&ti.EP_CAPTURE&&("b"===this._turn?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),"k"===this._board[e.to].type){if(this._kings[t]=e.to,e.flags&ti.KSIDE_CASTLE){let t=e.to-1,r=e.to+1;this._movePiece(r,t)}else if(e.flags&ti.QSIDE_CASTLE){let t=e.to+1,r=e.to-2;this._movePiece(r,t)}this._castling[t]=0}if(this._castling[t]){for(let r=0,i=tf[t].length;r<i;r++)if(e.from===tf[t][r].square&&this._castling[t]&tf[t][r].flag){this._castling[t]^=tf[t][r].flag;break}}if(this._castling[r]){for(let t=0,i=tf[r].length;t<i;t++)if(e.to===tf[r][t].square&&this._castling[r]&tf[r][t].flag){this._castling[r]^=tf[r][t].flag;break}}if(this._hash^=this._castlingKey(),e.flags&ti.BIG_PAWN){let i;i="b"===t?e.to-16:e.to+16,(e.to-1&136||this._board[e.to-1]?.type!=="p"||this._board[e.to-1]?.color!==r)&&(e.to+1&136||this._board[e.to+1]?.type!=="p"||this._board[e.to+1]?.color!==r)?this._epSquare=-1:(this._epSquare=i,this._hash^=this._epKey())}else this._epSquare=-1;"p"===e.piece||e.flags&(ti.CAPTURE|ti.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===t&&this._moveNumber++,this._turn=r,this._hash^=e9}undo(){let e=this._hash,t=this._undoMove();if(t){let r=new tt(this,t);return this._decPositionCount(e),r}return null}_undoMove(){let e=this._history.pop();if(void 0===e)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();let t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=e9;let r=this._turn,i=tv(r);if(t.flags&ti.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:r})),t.captured)if(t.flags&ti.EP_CAPTURE){let e;e="b"===r?t.to-16:t.to+16,this._set(e,{type:"p",color:i})}else this._set(t.to,{type:t.captured,color:i});if(t.flags&(ti.KSIDE_CASTLE|ti.QSIDE_CASTLE)){let e,r;t.flags&ti.KSIDE_CASTLE?(e=t.to+1,r=t.to-1):(e=t.to-2,r=t.to+1),this._movePiece(r,e)}return t}pgn({newline:e="\n",maxWidth:t=0}={}){let r=[],i=!1;for(let t in this._header)this._header[t]&&r.push(`[${t} "${this._header[t]}"]`+e),i=!0;i&&this._history.length&&r.push(e);let o=e=>{let t=this._comments[this.fen()];if(void 0!==t){let r=e.length>0?" ":"";e=`${e}${r}{${t}}`}return e},n=[];for(;this._history.length>0;)n.push(this._undoMove());let a=[],l="";for(0===n.length&&a.push(o(""));n.length>0;){l=o(l);let e=n.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(l.length&&a.push(l),l=this._moveNumber+".");else{let e=`${this._moveNumber}. ...`;l=l?`${l} ${e}`:e}l=l+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(l.length&&a.push(o(l)),a.push(this._header.Result||"*"),0===t)return r.join("")+a.join(" ");let s=function(){return r.length>0&&" "===r[r.length-1]&&(r.pop(),!0)},c=0;for(let i=0;i<a.length;i++){if(c+a[i].length>t&&a[i].includes("{")){c=function(i,o){for(let n of o.split(" "))if(n){if(i+n.length>t){for(;s();)i--;r.push(e),i=0}r.push(n),i+=n.length,r.push(" "),i++}return s()&&i--,i}(c,a[i]);continue}c+a[i].length>t&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(e),c=0):0!==i&&(r.push(" "),c++),r.push(a[i]),c+=a[i].length}return r.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??to[e]??null,this.getHeaders()}removeHeader(e){return e in this._header&&(this._header[e]=to[e]||null,!0)}getHeaders(){let e={};for(let[t,r]of Object.entries(this._header))null!==r&&(e[t]=r);return e}loadPgn(e,{strict:t=!1,newlineChar:r="\r?\n"}={}){"\r?\n"!==r&&(e=e.replace(RegExp(r,"g"),"\n"));let i=function(e,t){var r,i,o,n,a={},l=(t=void 0!==t?t:{}).grammarSource,s={pgn:eC},c=eC,u="O-O-O",h="0-0-0",d="1/2-1/2",p=/^[a-zA-Z]/,f=/^[^"]/,g=/^[0-9]/,m=/^[.]/,b=/^[a-zA-Z1-8\-=]/,v=/^[+#]/,_=/^[!?]/,w=/^[^}]/,y=/^[^\r\n]/,k=/^[ \t\r\n]/,C=e_("tag pair"),x=eb("[",!1),S=eb('"',!1),E=eb("]",!1),M=e_("tag name"),P=ev([["a","z"],["A","Z"]],!1,!1),A=e_("tag value"),T=ev(['"'],!0,!1),$=e_("move number"),I=ev([["0","9"]],!1,!1),O=eb(".",!1),L=ev(["."],!1,!1),j=e_("standard algebraic notation"),R=eb("O-O-O",!1),N=eb("O-O",!1),q=eb("0-0-0",!1),K=eb("0-0",!1),D=ev([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),F=ev(["+","#"],!1,!1),B=e_("suffix annotation"),z=ev(["!","?"],!1,!1),W=e_("NAG"),U=eb("$",!1),H=e_("brace comment"),V=eb("{",!1),G=ev(["}"],!0,!1),Q=eb("}",!1),X=e_("rest of line comment"),Z=eb(";",!1),Y=ev(["\r","\n"],!0,!1),J=e_("variation"),ee=eb("(",!1),et=eb(")",!1),er=e_("game termination marker"),ei=eb("1-0",!1),eo=eb("0-1",!1),en=eb("1/2-1/2",!1),ea=eb("*",!1),el=e_("whitespace"),es=ev([" ","	","\r","\n"],!1,!1),ec=function(e,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){let r=e.variations[0];if(!r){e.comment=t.marker.comment;break}e=r}}return{headers:e,root:t.root,result:(t.marker&&t.marker.result)??void 0}},eu=function(e,t){return function(...e){let[t,...r]=e,i=t;for(let e of r)null!==e&&(i.variations=[e,...e.variations],e.variations=[],i=e);return t}(null!==e?{comment:e,variations:[]}:{variations:[]},...t.flat())},eh=function(e,t,r,i,o){let n;return n={move:e,variations:o},t&&(n.suffix=t),r&&(n.nag=r),null!==i&&(n.comment=i),n},ed=0|t.peg$currPos,ep=[{line:1,column:1}],ef=ed,eg=t.peg$maxFailExpected||[],em=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw Error("Can't start parsing from rule \""+t.startRule+'".');c=s[t.startRule]}function eb(e,t){return{type:"literal",text:e,ignoreCase:t}}function ev(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function e_(e){return{type:"other",description:e}}function ew(t){var r,i=ep[t];if(i)return i;if(t>=ep.length)r=ep.length-1;else for(r=t;!ep[--r];);for(i={line:(i=ep[r]).line,column:i.column};r<t;)10===e.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return ep[t]=i,i}function ey(e,t,r){var i=ew(e),o=ew(t);return{source:l,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:o.line,column:o.column}}}function ek(e){ed<ef||(ed>ef&&(ef=ed,eg=[]),eg.push(e))}function eC(){var t;return t=function(){var e,t;for(e=[],t=ex();t!==a;)e.push(t),t=ex();return t=eT(),Object.fromEntries(e)}(),ec(t,function(){var t,r,i,o,n;return t=eS(),eT(),(em++,i=ed,"1-0"===e.substr(ed,3)?(o="1-0",ed+=3):(o=a,0===em&&ek(ei)),o===a&&("0-1"===e.substr(ed,3)?(o="0-1",ed+=3):(o=a,0===em&&ek(eo)),o===a&&(e.substr(ed,7)===d?(o=d,ed+=7):(o=a,0===em&&ek(en)),o===a&&(42===e.charCodeAt(ed)?(o="*",ed++):(o=a,0===em&&ek(ea))))),o!==a)?(eT(),(n=eP())===a&&(n=null),i={result:o,comment:n}):(ed=i,i=a),em--,i===a&&(o=a,0===em&&ek(er)),(r=i)===a&&(r=null),eT(),{root:t,marker:r}}())}function ex(){var t,r,i,o,n,l,s;return(em++,t=ed,eT(),91===e.charCodeAt(ed)?(r="[",ed++):(r=a,0===em&&ek(x)),r!==a&&(eT(),(i=function(){var t,r,i;if(em++,t=ed,r=[],i=e.charAt(ed),p.test(i)?ed++:(i=a,0===em&&ek(P)),i!==a)for(;i!==a;)r.push(i),i=e.charAt(ed),p.test(i)?ed++:(i=a,0===em&&ek(P));else r=a;return t=r!==a?e.substring(t,ed):r,em--,t===a&&(r=a,0===em&&ek(M)),t}())!==a&&(eT(),34===e.charCodeAt(ed)?(o='"',ed++):(o=a,0===em&&ek(S)),o!==a&&(n=function(){var t,r,i;for(em++,t=ed,r=[],i=e.charAt(ed),f.test(i)?ed++:(i=a,0===em&&ek(T));i!==a;)r.push(i),i=e.charAt(ed),f.test(i)?ed++:(i=a,0===em&&ek(T));return t=e.substring(t,ed),em--,r=a,0===em&&ek(A),t}(),34===e.charCodeAt(ed)?(l='"',ed++):(l=a,0===em&&ek(S)),l!==a&&(eT(),93===e.charCodeAt(ed)?(s="]",ed++):(s=a,0===em&&ek(E)),s!==a)))))?t=[i,n]:(ed=t,t=a),em--,t===a&&0===em&&ek(C),t}function eS(){var e,t,r;for((e=eP())===a&&(e=null),t=[],r=eE();r!==a;)t.push(r),r=eE();return eu(e,t)}function eE(){var t,r,i,o,n,l,s,c;if(t=ed,eT(),function(){var t,r,i,o,n,l;for(em++,t=ed,r=[],i=e.charAt(ed),g.test(i)?ed++:(i=a,0===em&&ek(I));i!==a;)r.push(i),i=e.charAt(ed),g.test(i)?ed++:(i=a,0===em&&ek(I));if(46===e.charCodeAt(ed)?(i=".",ed++):(i=a,0===em&&ek(O)),i!==a){for(o=eT(),n=[],l=e.charAt(ed),m.test(l)?ed++:(l=a,0===em&&ek(L));l!==a;)n.push(l),l=e.charAt(ed),m.test(l)?ed++:(l=a,0===em&&ek(L));t=r=[r,i,o,n]}else ed=t,t=a;em--,t===a&&(r=a,0===em&&ek($))}(),eT(),(r=function(){var t,r,i,o,n,l;if(em++,t=ed,r=ed,e.substr(ed,5)===u?(i=u,ed+=5):(i=a,0===em&&ek(R)),i===a&&("O-O"===e.substr(ed,3)?(i="O-O",ed+=3):(i=a,0===em&&ek(N)),i===a&&(e.substr(ed,5)===h?(i=h,ed+=5):(i=a,0===em&&ek(q)),i===a))&&("0-0"===e.substr(ed,3)?(i="0-0",ed+=3):(i=a,0===em&&ek(K)),i===a))if(i=ed,o=e.charAt(ed),p.test(o)?ed++:(o=a,0===em&&ek(P)),o!==a){if(n=[],l=e.charAt(ed),b.test(l)?ed++:(l=a,0===em&&ek(D)),l!==a)for(;l!==a;)n.push(l),l=e.charAt(ed),b.test(l)?ed++:(l=a,0===em&&ek(D));else n=a;n!==a?i=o=[o,n]:(ed=i,i=a)}else ed=i,i=a;return i!==a?(o=e.charAt(ed),v.test(o)?ed++:(o=a,0===em&&ek(F)),o===a&&(o=null),r=i=[i,o]):(ed=r,r=a),t=r!==a?e.substring(t,ed):r,em--,t===a&&(r=a,0===em&&ek(j)),t}())!==a){for((i=function(){var t,r,i;for(em++,t=ed,r=[],i=e.charAt(ed),_.test(i)?ed++:(i=a,0===em&&ek(z));i!==a;)r.push(i),r.length>=2?i=a:(i=e.charAt(ed),_.test(i)?ed++:(i=a,0===em&&ek(z)));return r.length<1?(ed=t,t=a):t=r,em--,t===a&&(r=a,0===em&&ek(B)),t}())===a&&(i=null),o=[],n=eM();n!==a;)o.push(n),n=eM();for(n=eT(),(l=eP())===a&&(l=null),s=[],c=eA();c!==a;)s.push(c),c=eA();t=eh(r,i,o,l,s)}else ed=t,t=a;return t}function eM(){var t,r,i,o,n;if(em++,t=ed,eT(),36===e.charCodeAt(ed)?(r="$",ed++):(r=a,0===em&&ek(U)),r!==a){if(i=ed,o=[],n=e.charAt(ed),g.test(n)?ed++:(n=a,0===em&&ek(I)),n!==a)for(;n!==a;)o.push(n),n=e.charAt(ed),g.test(n)?ed++:(n=a,0===em&&ek(I));else o=a;(i=o!==a?e.substring(i,ed):o)!==a?t=i:(ed=t,t=a)}else ed=t,t=a;return em--,t===a&&0===em&&ek(W),t}function eP(){var t;return(t=function(){var t,r,i,o,n;if(em++,t=ed,123===e.charCodeAt(ed)?(r="{",ed++):(r=a,0===em&&ek(V)),r!==a){for(i=ed,o=[],n=e.charAt(ed),w.test(n)?ed++:(n=a,0===em&&ek(G));n!==a;)o.push(n),n=e.charAt(ed),w.test(n)?ed++:(n=a,0===em&&ek(G));(i=e.substring(i,ed),125===e.charCodeAt(ed)?(o="}",ed++):(o=a,0===em&&ek(Q)),o!==a)?t=i.replace(/[\r\n]+/g," "):(ed=t,t=a)}else ed=t,t=a;return em--,t===a&&(r=a,0===em&&ek(H)),t}())===a&&(t=function(){var t,r,i,o,n;if(em++,t=ed,59===e.charCodeAt(ed)?(r=";",ed++):(r=a,0===em&&ek(Z)),r!==a){for(i=ed,o=[],n=e.charAt(ed),y.test(n)?ed++:(n=a,0===em&&ek(Y));n!==a;)o.push(n),n=e.charAt(ed),y.test(n)?ed++:(n=a,0===em&&ek(Y));t=(i=e.substring(i,ed)).trim()}else ed=t,t=a;return em--,t===a&&(r=a,0===em&&ek(X)),t}()),t}function eA(){var t,r,i,o;return(em++,t=ed,eT(),40===e.charCodeAt(ed)?(r="(",ed++):(r=a,0===em&&ek(ee)),r!==a&&(i=eS())!==a&&(eT(),41===e.charCodeAt(ed)?(o=")",ed++):(o=a,0===em&&ek(et)),o!==a))?t=i:(ed=t,t=a),em--,t===a&&0===em&&ek(J),t}function eT(){var t,r;for(em++,t=[],r=e.charAt(ed),k.test(r)?ed++:(r=a,0===em&&ek(es));r!==a;)t.push(r),r=e.charAt(ed),k.test(r)?ed++:(r=a,0===em&&ek(es));return em--,r=a,0===em&&ek(el),t}if(n=c(),t.peg$library)return{peg$result:n,peg$currPos:ed,peg$FAILED:a,peg$maxFailExpected:eg,peg$maxFailPos:ef};if(n!==a&&ed===e.length)return n;throw n!==a&&ed<e.length&&ek({type:"end"}),r=eg,i=ef<e.length?e.charAt(ef):null,o=ef<e.length?ey(ef,ef+1):ey(ef,ef),new e0(e0.buildMessage(r,i),r,i,o)}(e);this.reset();let o=i.headers,n="";for(let e in o)"fen"===e.toLowerCase()&&(n=o[e]),this.header(e,o[e]);if(t){if("1"===o.SetUp){if(!("FEN"in o))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}}else n&&this.load(n,{preserveHeaders:!0});let a=i.root;for(;a;){if(a.move){let e=this._moveFromSan(a.move,t);if(null==e)throw Error(`Invalid move in PGN: ${a.move}`);this._makeMove(e),this._incPositionCount()}void 0!==a.comment&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}let l=i.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(e,t){let r="";if(e.flags&ti.KSIDE_CASTLE)r="O-O";else if(e.flags&ti.QSIDE_CASTLE)r="O-O-O";else{if(e.flags&ti.NULL_MOVE)return"--";if("p"!==e.piece){let i=function(e,t){let r=e.from,i=e.to,o=e.piece,n=0,a=0,l=0;for(let e=0,s=t.length;e<s;e++){let s=t[e].from,c=t[e].to;o===t[e].piece&&r!==s&&i===c&&(n++,r>>4==s>>4&&a++,(15&r)==(15&s)&&l++)}if(n>0)if(a>0&&l>0)return tb(r);else if(l>0)return tb(r).charAt(1);else return tb(r).charAt(0);return""}(e,t);r+=e.piece.toUpperCase()+i}e.flags&(ti.CAPTURE|ti.EP_CAPTURE)&&("p"===e.piece&&(r+=tb(e.from)[0]),r+="x"),r+=tb(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,t=!1){let r,i,o,n,a,l=ty(e);if(t||("0-0"===l?l="O-O":"0-0-0"===l&&(l="O-O-O")),"--"==l)return{color:this._turn,from:0,to:0,piece:"k",flags:ti.NULL_MOVE};let s=tw(l),c=this._moves({legal:!0,piece:s});for(let e=0,t=c.length;e<t;e++)if(l===ty(this._moveToSan(c[e],c)))return c[e];if(t)return null;let u=!1;if((i=l.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(r=i[1],o=i[2],n=i[3],a=i[4],1==o.length&&(u=!0)):(i=l.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(r=i[1],o=i[2],n=i[3],a=i[4],1==o.length&&(u=!0)),s=tw(l),c=this._moves({legal:!0,piece:r||s}),!n)return null;for(let e=0,t=c.length;e<t;e++)if(o){if((!r||r.toLowerCase()==c[e].piece)&&ta[o]==c[e].from&&ta[n]==c[e].to&&(!a||a.toLowerCase()==c[e].promotion))return c[e];else if(u){let t=tb(c[e].from);if((!r||r.toLowerCase()==c[e].piece)&&ta[n]==c[e].to&&(o==t[0]||o==t[1])&&(!a||a.toLowerCase()==c[e].promotion))return c[e]}}else if(l===ty(this._moveToSan(c[e],c)).replace("x",""))return c[e];return null}ascii(){let e="   +------------------------+\n";for(let t=ta.a8;t<=ta.h1;t++){if(0==(15&t)&&(e+=" "+"87654321"[t>>4]+" |"),this._board[t]){let r=this._board[t].type;e+=" "+("w"===this._board[t].color?r.toUpperCase():r.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(e){let t=this._moves({legal:!1}),r=0,i=this._turn;for(let o=0,n=t.length;o<n;o++)this._makeMove(t[o]),!this._isKingAttacked(i)&&(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}setTurn(e){return this._turn!=e&&(this.move("--"),!0)}turn(){return this._turn}board(){let e=[],t=[];for(let r=ta.a8;r<=ta.h1;r++)null==this._board[r]?t.push(null):t.push({square:tb(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}squareColor(e){if(e in ta){let t=ta[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){let t=[],r=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){let i=t.pop();if(!i)break;e?r.push(new tt(this,i)):r.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return r}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){let t=this._positionCount.get(e)??0;1===t?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){let e=[],t={},r=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){let t=e.pop();if(!t)break;this._makeMove(t),r(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{let t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(let r of["k","q"])void 0!==t[r]&&(t[r]?this._castling[e]|=tp[r]:this._castling[e]&=~tp[r]);this._updateCastlingRights();let r=this.getCastlingRights(e);return(void 0===t.k||t.k===r.k)&&(void 0===t.q||t.q===r.q)}getCastlingRights(e){return{k:(this._castling[e]&tp.k)!=0,q:(this._castling[e]&tp.q)!=0}}moveNumber(){return this._moveNumber}}var tC=e.i(3974),tx=e.i(13854),tS=e.i(76552),tE=e.i(34251),tM=e.i(7670),tP=e.i(19130),tA=e.i(54624);let tT=(0,tA.default)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");var t$=e.i(19636),tI=e.i(42196),tO=e.i(54033),tL=e.i(40799),tj=e.i(75149),tR=e.i(35057),tN=e.i(94425),tq=e.i(40672),tK=e.i(19727);function tD(e){return(0,tK.default)("MuiChip",e)}let tF=(0,tq.default)("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]);var tB=e.i(48106);let tz=(0,tL.styled)("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e,{color:i,iconColor:o,clickable:n,onDelete:a,size:l,variant:s}=r;return[{[`& .${tF.avatar}`]:t.avatar},{[`& .${tF.avatar}`]:t[`avatar${(0,tI.default)(l)}`]},{[`& .${tF.avatar}`]:t[`avatarColor${(0,tI.default)(i)}`]},{[`& .${tF.icon}`]:t.icon},{[`& .${tF.icon}`]:t[`icon${(0,tI.default)(l)}`]},{[`& .${tF.icon}`]:t[`iconColor${(0,tI.default)(o)}`]},{[`& .${tF.deleteIcon}`]:t.deleteIcon},{[`& .${tF.deleteIcon}`]:t[`deleteIcon${(0,tI.default)(l)}`]},{[`& .${tF.deleteIcon}`]:t[`deleteIconColor${(0,tI.default)(i)}`]},{[`& .${tF.deleteIcon}`]:t[`deleteIcon${(0,tI.default)(s)}Color${(0,tI.default)(i)}`]},t.root,t[`size${(0,tI.default)(l)}`],t[`color${(0,tI.default)(i)}`],n&&t.clickable,n&&"default"!==i&&t[`clickableColor${(0,tI.default)(i)}`],a&&t.deletable,a&&"default"!==i&&t[`deletableColor${(0,tI.default)(i)}`],t[s],t[`${s}${(0,tI.default)(i)}`]]}})((0,tj.default)(({theme:e})=>{let t="light"===e.palette.mode?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:16,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${tF.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${tF.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:t,fontSize:e.typography.pxToRem(12)},[`& .${tF.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${tF.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${tF.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${tF.icon}`]:{marginLeft:5,marginRight:-6},[`& .${tF.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${tF.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${tF.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter((0,tR.default)(["contrastText"])).map(([t])=>({props:{color:t},style:{backgroundColor:(e.vars||e).palette[t].main,color:(e.vars||e).palette[t].contrastText,[`& .${tF.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[t].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[t].contrastText}}}})),{props:e=>e.iconColor===e.color,style:{[`& .${tF.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:t}}},{props:e=>e.iconColor===e.color&&"default"!==e.color,style:{[`& .${tF.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${tF.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter((0,tR.default)(["dark"])).map(([t])=>({props:{color:t,onDelete:!0},style:{[`&.${tF.focusVisible}`]:{background:(e.vars||e).palette[t].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${tF.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter((0,tR.default)(["dark"])).map(([t])=>({props:{color:t,clickable:!0},style:{[`&:hover, &.${tF.focusVisible}`]:{backgroundColor:(e.vars||e).palette[t].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${"light"===e.palette.mode?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${tF.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${tF.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${tF.avatar}`]:{marginLeft:4},[`& .${tF.avatarSmall}`]:{marginLeft:2},[`& .${tF.icon}`]:{marginLeft:4},[`& .${tF.iconSmall}`]:{marginLeft:2},[`& .${tF.deleteIcon}`]:{marginRight:5},[`& .${tF.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter((0,tR.default)()).map(([t])=>({props:{variant:"outlined",color:t},style:{color:(e.vars||e).palette[t].main,border:`1px solid ${e.alpha((e.vars||e).palette[t].main,.7)}`,[`&.${tF.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${tF.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.focusOpacity)},[`& .${tF.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[t].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[t].main}}}}))]}})),tW=(0,tL.styled)("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,t)=>{let{ownerState:r}=e,{size:i}=r;return[t.label,t[`label${(0,tI.default)(i)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function tU(e){return"Backspace"===e.key||"Delete"===e.key}let tH=l.forwardRef(function(e,t){let i=(0,tN.useDefaultProps)({props:e,name:"MuiChip"}),{avatar:o,className:n,clickable:a,color:s="default",component:c,deleteIcon:u,disabled:h=!1,icon:d,label:p,onClick:f,onDelete:g,onKeyDown:m,onKeyUp:b,size:v="medium",variant:_="filled",tabIndex:w,skipFocusWhenDisabled:y=!1,slots:k={},slotProps:C={},...x}=i,S=l.useRef(null),E=(0,t$.default)(S,t),M=e=>{e.stopPropagation(),g&&g(e)},P=!1!==a&&!!f||a,A=P||g?tO.default:c||"div",T={...i,component:A,disabled:h,size:v,color:s,iconColor:l.isValidElement(d)&&d.props.color||s,onDelete:!!g,clickable:P,variant:_},$=(e=>{let{classes:t,disabled:r,size:i,color:o,iconColor:n,onDelete:a,clickable:l,variant:s}=e,c={root:["root",s,r&&"disabled",`size${(0,tI.default)(i)}`,`color${(0,tI.default)(o)}`,l&&"clickable",l&&`clickableColor${(0,tI.default)(o)}`,a&&"deletable",a&&`deletableColor${(0,tI.default)(o)}`,`${s}${(0,tI.default)(o)}`],label:["label",`label${(0,tI.default)(i)}`],avatar:["avatar",`avatar${(0,tI.default)(i)}`,`avatarColor${(0,tI.default)(o)}`],icon:["icon",`icon${(0,tI.default)(i)}`,`iconColor${(0,tI.default)(n)}`],deleteIcon:["deleteIcon",`deleteIcon${(0,tI.default)(i)}`,`deleteIconColor${(0,tI.default)(o)}`,`deleteIcon${(0,tI.default)(s)}Color${(0,tI.default)(o)}`]};return(0,tP.default)(c,tD,t)})(T),I=A===tO.default?{component:c||"div",focusVisibleClassName:$.focusVisible,...g&&{disableRipple:!0}}:{},O=null;g&&(O=u&&l.isValidElement(u)?l.cloneElement(u,{className:(0,tM.default)(u.props.className,$.deleteIcon),onClick:M}):(0,r.jsx)(tT,{className:$.deleteIcon,onClick:M}));let L=null;o&&l.isValidElement(o)&&(L=l.cloneElement(o,{className:(0,tM.default)($.avatar,o.props.className)}));let j=null;d&&l.isValidElement(d)&&(j=l.cloneElement(d,{className:(0,tM.default)($.icon,d.props.className)}));let R={slots:k,slotProps:C},[N,q]=(0,tB.default)("root",{elementType:tz,externalForwardedProps:{...R,...x},ownerState:T,shouldForwardComponentProp:!0,ref:E,className:(0,tM.default)($.root,n),additionalProps:{disabled:!!P&&!!h||void 0,tabIndex:y&&h?-1:w,...I},getSlotProps:e=>({...e,onClick:t=>{e.onClick?.(t),f?.(t)},onKeyDown:t=>{e.onKeyDown?.(t),t.currentTarget===t.target&&tU(t)&&t.preventDefault(),m&&m(t)},onKeyUp:t=>{e.onKeyUp?.(t),t.currentTarget===t.target&&g&&tU(t)&&g(t),b&&b(t)}})}),[K,D]=(0,tB.default)("label",{elementType:tW,externalForwardedProps:R,ownerState:T,className:$.label});return(0,r.jsxs)(N,{as:A,...q,children:[L||j,(0,r.jsx)(K,{...D,children:p}),O]})});var tV=e.i(37828),tG=e.i(32963),tQ=e.i(10669),tX=e.i(52836),tZ=e.i(77539);let tY=function(e={}){let{autoHideDuration:t=null,disableWindowBlurListener:r=!1,onClose:i,open:o,resumeHideDuration:n}=e,a=(0,tX.default)();l.useEffect(()=>{if(o)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){e.defaultPrevented||"Escape"!==e.key||i?.(e,"escapeKeyDown")}},[o,i]);let s=(0,tQ.default)((e,t)=>{i?.(e,t)}),c=(0,tQ.default)(e=>{i&&null!=e&&a.start(e,()=>{s(null,"timeout")})});l.useEffect(()=>(o&&c(t),a.clear),[o,t,c,a]);let u=a.clear,h=l.useCallback(()=>{null!=t&&c(null!=n?n:.5*t)},[t,n,c]);return l.useEffect(()=>{if(!r&&o)return window.addEventListener("focus",h),window.addEventListener("blur",u),()=>{window.removeEventListener("focus",h),window.removeEventListener("blur",u)}},[r,o,h,u]),{getRootProps:(t={})=>{let r={...(0,tZ.default)(e),...(0,tZ.default)(t)};return{role:"presentation",...t,...r,onBlur:e=>{let t=r.onBlur;t?.(e),h()},onFocus:e=>{let t=r.onFocus;t?.(e),u()},onMouseEnter:e=>{let t=r.onMouseEnter;t?.(e),u()},onMouseLeave:e=>{let t=r.onMouseLeave;t?.(e),h()}}},onClickAway:e=>{i?.(e,"clickaway")}}};var tJ=e.i(13714),t0=e.i(81908),t1=e.i(52174);function t2(e){return e.substring(2).toLowerCase()}function t6(e){let{children:t,disableReactTree:r=!1,mouseEvent:i="onClick",onClickAway:o,touchEvent:n="onTouchEnd"}=e,a=l.useRef(!1),s=l.useRef(null),c=l.useRef(!1),u=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{c.current=!0},0),()=>{c.current=!1}),[]);let h=(0,t0.default)((0,t1.default)(t),s),d=(0,tQ.default)(e=>{let t=u.current;u.current=!1;let i=(0,tJ.default)(s.current);if(!(!c.current||!s.current||"clientX"in e&&(i.documentElement.clientWidth<e.clientX||i.documentElement.clientHeight<e.clientY))){if(a.current){a.current=!1;return}(e.composedPath?e.composedPath().includes(s.current):!i.documentElement.contains(e.target)||s.current.contains(e.target))||!r&&t||o(e)}}),p=e=>r=>{u.current=!0;let i=t.props[e];i&&i(r)},f={ref:h};return!1!==n&&(f[n]=p(n)),l.useEffect(()=>{if(!1!==n){let e=t2(n),t=(0,tJ.default)(s.current),r=()=>{a.current=!0};return t.addEventListener(e,d),t.addEventListener("touchmove",r),()=>{t.removeEventListener(e,d),t.removeEventListener("touchmove",r)}}},[d,n]),!1!==i&&(f[i]=p(i)),l.useEffect(()=>{if(!1!==i){let e=t2(i),t=(0,tJ.default)(s.current);return t.addEventListener(e,d),()=>{t.removeEventListener(e,d)}}},[d,i]),l.cloneElement(t,f)}var t8=e.i(10557),t4=e.i(55720),t3=e.i(67239),t5=e.i(67719);function t7(e){return(0,tK.default)("MuiSnackbarContent",e)}(0,tq.default)("MuiSnackbarContent",["root","message","action"]);let t9=(0,tL.styled)(t5.default,{name:"MuiSnackbarContent",slot:"Root"})((0,tj.default)(({theme:e})=>{let t="light"===e.palette.mode?.8:.98;return{...e.typography.body2,color:e.vars?e.vars.palette.SnackbarContent.color:e.palette.getContrastText((0,t3.emphasize)(e.palette.background.default,t)),backgroundColor:e.vars?e.vars.palette.SnackbarContent.bg:(0,t3.emphasize)(e.palette.background.default,t),display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",flexGrow:1,[e.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}}})),re=(0,tL.styled)("div",{name:"MuiSnackbarContent",slot:"Message"})({padding:"8px 0"}),rt=(0,tL.styled)("div",{name:"MuiSnackbarContent",slot:"Action"})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),rr=l.forwardRef(function(e,t){let i=(0,tN.useDefaultProps)({props:e,name:"MuiSnackbarContent"}),{action:o,className:n,message:a,role:l="alert",...s}=i,c=(e=>{let{classes:t}=e;return(0,tP.default)({root:["root"],action:["action"],message:["message"]},t7,t)})(i);return(0,r.jsxs)(t9,{role:l,elevation:6,className:(0,tM.default)(c.root,n),ownerState:i,ref:t,...s,children:[(0,r.jsx)(re,{className:c.message,ownerState:i,children:a}),o?(0,r.jsx)(rt,{className:c.action,ownerState:i,children:o}):null]})});function ri(e){return(0,tK.default)("MuiSnackbar",e)}(0,tq.default)("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);let ro=(0,tL.styled)("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,t[`anchorOrigin${(0,tI.default)(r.anchorOrigin.vertical)}${(0,tI.default)(r.anchorOrigin.horizontal)}`]]}})((0,tj.default)(({theme:e})=>({zIndex:(e.vars||e).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center",variants:[{props:({ownerState:e})=>"top"===e.anchorOrigin.vertical,style:{top:8,[e.breakpoints.up("sm")]:{top:24}}},{props:({ownerState:e})=>"top"!==e.anchorOrigin.vertical,style:{bottom:8,[e.breakpoints.up("sm")]:{bottom:24}}},{props:({ownerState:e})=>"left"===e.anchorOrigin.horizontal,style:{justifyContent:"flex-start",[e.breakpoints.up("sm")]:{left:24,right:"auto"}}},{props:({ownerState:e})=>"right"===e.anchorOrigin.horizontal,style:{justifyContent:"flex-end",[e.breakpoints.up("sm")]:{right:24,left:"auto"}}},{props:({ownerState:e})=>"center"===e.anchorOrigin.horizontal,style:{[e.breakpoints.up("sm")]:{left:"50%",right:"auto",transform:"translateX(-50%)"}}}]}))),rn=l.forwardRef(function(e,t){let i=(0,tN.useDefaultProps)({props:e,name:"MuiSnackbar"}),o=(0,t8.useTheme)(),n={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{action:a,anchorOrigin:{vertical:s,horizontal:c}={vertical:"bottom",horizontal:"left"},autoHideDuration:u=null,children:h,className:d,ClickAwayListenerProps:p,ContentProps:f,disableWindowBlurListener:g=!1,message:m,onBlur:b,onClose:v,onFocus:_,onMouseEnter:w,onMouseLeave:y,open:k,resumeHideDuration:C,slots:x={},slotProps:S={},TransitionComponent:E,transitionDuration:M=n,TransitionProps:{onEnter:P,onExited:A,...T}={},...$}=i,I={...i,anchorOrigin:{vertical:s,horizontal:c},autoHideDuration:u,disableWindowBlurListener:g,TransitionComponent:E,transitionDuration:M},O=(e=>{let{classes:t,anchorOrigin:r}=e,i={root:["root",`anchorOrigin${(0,tI.default)(r.vertical)}${(0,tI.default)(r.horizontal)}`]};return(0,tP.default)(i,ri,t)})(I),{getRootProps:L,onClickAway:j}=tY(I),[R,N]=l.useState(!0),q={slots:{transition:E,...x},slotProps:{content:f,clickAwayListener:p,transition:T,...S}},[K,D]=(0,tB.default)("root",{ref:t,className:[O.root,d],elementType:ro,getSlotProps:L,externalForwardedProps:{...q,...$},ownerState:I}),[F,{ownerState:B,...z}]=(0,tB.default)("clickAwayListener",{elementType:t6,externalForwardedProps:q,getSlotProps:e=>({onClickAway:(...t)=>{let r=t[0];e.onClickAway?.(...t),r?.defaultMuiPrevented||j(...t)}}),ownerState:I}),[W,U]=(0,tB.default)("content",{elementType:rr,shouldForwardComponentProp:!0,externalForwardedProps:q,additionalProps:{message:m,action:a},ownerState:I}),[H,V]=(0,tB.default)("transition",{elementType:t4.default,externalForwardedProps:q,getSlotProps:e=>({onEnter:(...t)=>{e.onEnter?.(...t),((e,t)=>{N(!1),P&&P(e,t)})(...t)},onExited:(...t)=>{e.onExited?.(...t),(e=>{N(!0),A&&A(e)})(...t)}}),additionalProps:{appear:!0,in:k,timeout:M,direction:"top"===s?"down":"up"},ownerState:I});return!k&&R?null:(0,r.jsx)(F,{...z,...x.clickAwayListener&&{ownerState:B},children:(0,r.jsx)(K,{...D,children:(0,r.jsx)(H,{...V,children:h||(0,r.jsx)(W,{...U})})})})});var ra=e.i(63745),rl=e.i(66796),rs=e.i(85301),rc=e.i(8979),ru=e.i(83270),rh=e.i(88830),rd=e.i(18452),rp=e.i(80646),rf=e.i(8187),rg=e.i(52835),rm=e.i(80132),rb=e.i(97579),rv=e.i(4052);function r_(e){return(0,tK.default)("MuiTableHead",e)}(0,tq.default)("MuiTableHead",["root"]);let rw=(0,tL.styled)("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),ry={variant:"head"},rk="thead",rC=l.forwardRef(function(e,t){let i=(0,tN.useDefaultProps)({props:e,name:"MuiTableHead"}),{className:o,component:n=rk,...a}=i,l={...i,component:n},s=(e=>{let{classes:t}=e;return(0,tP.default)({root:["root"]},r_,t)})(l);return(0,r.jsx)(rv.default.Provider,{value:ry,children:(0,r.jsx)(rw,{as:n,className:(0,tM.default)(s.root,o),ref:t,role:n===rk?null:"rowgroup",ownerState:l,...a})})}),rx=(0,tA.default)((0,r.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");var rS=e.i(50028),rE=e.i(70607);let rM=function(e){let t,o,n,a,s=(0,i.c)(11),{textToCopy:c}=e,{currentUser:u}=(0,l.useContext)(ru.CurrentUserContext),[h,d]=(0,l.useState)(!1);s[0]!==c?(t=async()=>{try{await navigator.clipboard.writeText(c),d(!0),setTimeout(()=>d(!1),2e3)}catch(e){console.error("Failed to copy text: ",e)}},s[0]=c,s[1]=t):t=s[1];let p=t;return s[2]!==h?(o=h?(0,r.jsx)(rS.default,{}):(0,r.jsx)(rx,{}),s[2]=h,s[3]=o):o=s[3],s[4]!==h||s[5]!==u.language?(n=h?(0,r.jsx)(r.Fragment,{children:(0,rE.default)("Xcopied",u.language,"PGN")}):(0,r.jsx)(r.Fragment,{children:(0,rE.default)("copyX",u.language,"PGN")}),s[4]=h,s[5]=u.language,s[6]=n):n=s[6],s[7]!==p||s[8]!==o||s[9]!==n?(a=(0,r.jsx)(tE.Button,{variant:"contained",color:"primary",onClick:p,startIcon:o,children:n}),s[7]=p,s[8]=o,s[9]=n,s[10]=a):a=s[10],a};function rP(e){let t,o,n,a,s,c,u,h,d,p,f,g,m=(0,i.c)(28),{pgn:b,fen:v}=e,{currentUser:_}=(0,l.useContext)(ru.CurrentUserContext),[w,y]=(0,l.useState)("");m[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],m[0]=t):t=m[0];let[k,C]=(0,l.useState)(t),[x,S]=(0,l.useState)(""),[E,M]=(0,l.useState)(0),P=(0,l.useRef)(null),A=r$,T=rT;m[1]===Symbol.for("react.memo_cache_sentinel")?(o=e=>{let t={white:{king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0},black:{king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0}};for(let r=0,i=0;r<e.length&&i<8;r++){let o=e[r],n=o.toLowerCase(),a=T(o);if(a){let e=o===n?"black":"white",r=t[A(e)];r[a]>0?r[a]=r[a]-1:t[e][a]=t[e][a]+1}else if("["===o||" "===o)break;else"/"===o&&i++}return t},m[1]=o):o=m[1];let $=o;m[2]!==x?(n=()=>{let e=$(x);M((e.white.queen-e.black.queen)*9+(e.white.rook-e.black.rook)*5+(e.white.bishop-e.black.bishop)*3+(e.white.knight-e.black.knight)*3+(e.white.pawn-e.black.pawn))},m[2]=x,m[3]=n):n=m[3];let I=n;return m[4]!==b||m[5]!==w?(a=()=>{if(b!==w){y(b);let e=b.split(/\r?\n/).slice(-1)[0].split(" ").slice(0,-1),t=[];for(let r=1;r<e.length;r+=3)t.push({n:e[r-1].split(".")[0],w:e[r],b:e[r+1]?e[r+1]:""});C(t),P.current&&(P.current.scrollTop=P.current.scrollHeight)}},m[4]=b,m[5]=w,m[6]=a):a=m[6],m[7]!==b?(s=[b],m[7]=b,m[8]=s):s=m[8],(0,l.useEffect)(a,s),m[9]!==v||m[10]!==x?(c=()=>{if("string"==typeof v&&v.length>0){let e=v.split(" ")[0];e!==x&&S(e)}},m[9]=v,m[10]=x,m[11]=c):c=m[11],m[12]!==v?(u=[v],m[12]=v,m[13]=u):u=m[13],(0,l.useEffect)(c,u),m[14]!==I?(h=()=>{I()},m[14]=I,m[15]=h):h=m[15],m[16]!==x?(d=[x],m[16]=x,m[17]=d):d=m[17],(0,l.useEffect)(h,d),m[18]!==_||m[19]!==k||m[20]!==E?(p=k.length>0&&(0,r.jsx)(tG.Paper,{sx:{width:"100%",overflow:"hidden"},children:(0,r.jsx)(rb.TableContainer,{sx:{maxHeight:130,overflowY:"auto"},ref:P,children:(0,r.jsxs)(rp.Table,{size:"small",stickyHeader:!0,children:[(0,r.jsx)(rC,{children:(0,r.jsxs)(rg.TableRow,{children:[(0,r.jsx)(rm.TableCell,{align:"center",sx:{width:"20%"},children:(0,rE.default)("move",_.language)}),(0,r.jsxs)(rm.TableCell,{align:"center",sx:{width:"40%"},children:[(0,rE.default)("white",_.language),(0,r.jsx)(rl.Typography,{variant:"span",color:"#bababa",sx:{pl:1,fontSize:"0.8em"},children:E>0?"+"+E:""})]}),(0,r.jsxs)(rm.TableCell,{align:"center",sx:{width:"40%"},children:[(0,rE.default)("black",_.language),(0,r.jsx)(rl.Typography,{variant:"span",color:"#bababa",sx:{pl:1,fontSize:"0.8em"},children:E<0?"+"+-E:""})]})]})}),(0,r.jsx)(rf.TableBody,{children:k.map(rA)})]})})}),m[18]=_,m[19]=k,m[20]=E,m[21]=p):p=m[21],m[22]!==k.length||m[23]!==w?(f=k.length>0&&(0,r.jsx)(ra.Stack,{spacing:2,sx:{mt:2,mb:5},children:(0,r.jsx)(rM,{textToCopy:w})}),m[22]=k.length,m[23]=w,m[24]=f):f=m[24],m[25]!==p||m[26]!==f?(g=(0,r.jsxs)(r.Fragment,{children:[p,f]}),m[25]=p,m[26]=f,m[27]=g):g=m[27],g}function rA(e){return(0,r.jsxs)(rg.TableRow,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,r.jsx)(rm.TableCell,{align:"center",sx:{width:"20%"},children:e.n}),(0,r.jsx)(rm.TableCell,{align:"center",sx:{width:"40%"},children:e.w}),(0,r.jsx)(rm.TableCell,{align:"center",sx:{width:"40%"},children:e.b})]},e.n)}function rT(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function r$(e){return"white"===e?"black":"white"}var rI=e.i(22500),rO=e.i(92863);let rL=(0,a.createTheme)({colorSchemes:{dark:!0}});class rj{constructor(){this.wasmSupported="object"==typeof WebAssembly&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0)),this.worker=new Worker(this.wasmSupported?"/js/stockfish.wasm.js":"/js/stockfish.js"),this.onMessage=null,this.initialized=!1,this.uciElo=100,this.skillLevel=0,this.depth=1,this.moveTime=500,this.limitStrength=!0,this.worker.onmessage=e=>{this.onMessage&&this.onMessage(e.data)}}init(){this.sendCommand("uci"),this.sendCommand("isready"),this.initialized=!0}setDifficulty(e){let t=(0,rI.default)(e);this.uciElo=t.uciElo,this.skillLevel=t.skillLevel,this.depth=t.depth,this.moveTime=t.moveTime,this.limitStrength=t.limitStrength,this.sendCommand(`setoption name Skill Level value ${this.skillLevel}`),this.sendCommand(`setoption name UCI_LimitStrength value ${this.limitStrength}`),this.uciElo&&this.sendCommand(`setoption name UCI_Elo value ${this.uciElo}`)}sendCommand(e){this.worker.postMessage(e)}setPosition(e,t=[]){let r=`position fen ${e}`;t.length>0&&(r=`position fen ${e} moves ${t.join(" ")}`),this.sendCommand(r)}getBestMove(){this.sendCommand("stop"),this.skillLevel<=3?this.sendCommand(`go depth ${this.depth}`):this.skillLevel<=8?this.sendCommand(`go depth ${this.depth} movetime ${this.moveTime}`):this.sendCommand(`go movetime ${this.moveTime}`)}stop(){this.sendCommand("stop")}destroy(){this.worker.terminate()}}function rR(){let e=(0,o.useRouter)(),{currentUser:t,setCurrentUser:i}=(0,l.useContext)(ru.CurrentUserContext),{socket:a}=(0,l.useContext)(rh.SocketContext),d=(0,o.useSearchParams)().get("id"),[m,w]=(0,l.useState)(!1),[E,T]=(0,l.useState)(!0),[L,j]=(0,l.useState)(!1),[R,N]=(0,l.useState)(new tk),[z,W]=(0,l.useState)({}),[V,Q]=(0,l.useState)(""),[Z,Y]=(0,l.useState)(null),[eo,ec]=(0,l.useState)("white"),[eu,ep]=(0,l.useState)([]),[ef,eg]=(0,l.useState)(),[eE,eT]=(0,l.useState)(null),[e0,e1]=(0,l.useState)(!1),[e2,e6]=(0,l.useState)(null),[e8,e4]=l.default.useState(!1),e3=(e,t)=>{"clickaway"!==t&&e4(!1)},e5=(0,l.useRef)(null),e7=(0,l.useRef)(null),e9=(0,l.useRef)(!1),te=z.players?.black==="Computer";(0,l.useEffect)(()=>{if(te&&!eE){let e=new rj;e.init(),e.onMessage=e=>{if(e.startsWith("bestmove")){let t=e.split(" ");t[1]&&"(none)"!==t[1]&&e6(t[1]),e1(!1)}},e.setDifficulty(t.computerStrength||0),eT(e)}return()=>{eE&&eE.destroy()}},[te]),(0,l.useEffect)(()=>{e0&&!R.isGameOver()&&(!eE||!te||R.isGameOver()||tt||null===Z||(eE.setPosition(R.fen()),.2>Math.random()&&eE.setDifficulty(t.computerStrength||0),eE.getBestMove()))},[R,eE,te,e0]),(0,l.useEffect)(()=>{a&&a.emit("list of games",{})},[]),(0,l.useEffect)(()=>{z.players&&t.login&&(z.players.white===t.login?Y("white"):z.players.black===t.login&&Y("black"))},[z,t]),(0,l.useEffect)(()=>{ec("w"===R.turn()?"white":"black"),te&&"b"===R.turn()&&e1(!0)},[R]);let tt=Z===eo,tr=z&&"ongoing"===z.status&&z.players&&null!==z.players.white&&null!==z.players.black,ti=(0,l.useCallback)(()=>{let e=new Map;for(let t=0;t<64;t++){let r="abcdefgh"[t%8]+(Math.floor(t/8)+1),i=R.moves({square:r,verbose:!0});i.length>0&&e.set(r,i.map(e=>e.to))}return e},[R]),to=(0,l.useCallback)(()=>{let e="",r=!1;return R.isCheckmate()?(e=`${(0,rE.default)("checkmate",t.language)}. ${"w"===R.turn()?(0,rE.default)("blackWinsGame",t.language):(0,rE.default)("whiteWinsGame",t.language)}`,r=!0):R.isStalemate()?(e=`${(0,rE.default)("stalemate",t.language)}. ${(0,rE.default)("draw",t.language)}`,r=!0):R.isInsufficientMaterial()?(e=`${(0,rE.default)("insufficientMaterial",t.language)}. ${(0,rE.default)("draw",t.language)}`,r=!0):R.isThreefoldRepetition()?(e=`${(0,rE.default)("threefoldRepetition",t.language)}. ${(0,rE.default)("draw",t.language)}`,r=!0):R.isDraw()?(e=`${(0,rE.default)("draw",t.language)} ${(0,rE.default)("by50MoveRule",t.language)}`,r=!0):e=R.isCheck()?`${"w"===R.turn()?(0,rE.default)("whiteIsInCheck",t.language):(0,rE.default)("blackIsInCheck",t.language)}!`:`${"w"===R.turn()?(0,rE.default)("whitesTurn",t.language):(0,rE.default)("blacksTurn",t.language)}`,(r||!e0)&&eE&&te&&eE.stop(),{gameOver:r,status:e,isCheck:R.isCheck(),isCheckmate:R.isCheckmate(),isDraw:R.isDraw()}},[R]),tn=(0,l.useCallback)((e,r)=>{if(!tt)return!1;try{let i=R.get(e);if(i&&("white"===Z&&"w"!==i.color||"black"===Z&&"b"!==i.color))return!1;if(i&&"p"===i.type&&("w"===i.color&&"8"===r[1]||"b"===i.color&&"1"===r[1])?R.move({from:e,to:r,promotion:"q"}):R.move({from:e,to:r})){ep([e,r]);let i=new tk;return i.loadPgn(R.pgn()),N(i),Q(i.pgn()),a.emit("update game",{gameId:d,login:t.login,token:t.token,pgn:i.pgn()}),!0}return!1}catch(e){return console.error("Invalid move:",e),!1}},[R,a,d,t,tt,tr,Z]);return((0,l.useEffect)(()=>{if(e2&&!tt&&null!==Z)try{let e=R.move(e2);if(e){ep([e.from,e.to]);let r=new tk;r.loadPgn(R.pgn()),N(r),Q(r.pgn()),a.emit("update game",{gameId:d,login:t.login,token:t.token,pgn:r.pgn()}),e1(!1),e6(null)}}catch(e){console.error("Computer move error:",e)}},[e2,e0]),(0,l.useEffect)(()=>(e5.current&&!e9.current&&(e9.current=!0,to(),e7.current=function(e,t){let r,i={pieces:ea(ei),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:{start(){r=performance.now()},cancel(){r=void 0},stop(){if(!r)return 0;let e=performance.now()-r;return r=void 0,e}}};function o(){var t;let r,o="dom"in i?i.dom.unbind:void 0,n=function(e,t){let r,i,o,n,a,l;for(let r of(e.innerHTML="",e.classList.add("cg-wrap"),s))e.classList.toggle("orientation-"+r,t.orientation===r);e.classList.toggle("manipulable",!t.viewOnly);let h=P("cg-container");e.appendChild(h);let d=P("cg-board");if(h.appendChild(d),t.drawable.visible&&([r,i]=["cg-shapes-below","cg-shapes"].map(e=>eF(e,!0)),[o,n]=["cg-custom-below","cg-custom-svgs"].map(e=>eF(e,!1)),a=P("cg-auto-pieces"),h.appendChild(r),h.appendChild(o),h.appendChild(i),h.appendChild(n),h.appendChild(a)),t.coordinates){let e="black"===t.orientation?" black":"",r="left"===t.ranksPosition?" left":"";if(t.coordinatesOnSquares){let i="white"===t.orientation?e=>e+1:e=>8-e;c.forEach((t,o)=>h.appendChild(eB(u.map(e=>t+e),"squares rank"+i(o)+e+r)))}else h.appendChild(eB(u,"ranks"+e+r)),h.appendChild(eB(c,"files"+e))}return t.draggable.enabled&&t.draggable.showGhost&&(x(l=P("piece","ghost"),!1),h.appendChild(l)),{board:d,container:h,wrap:e,ghost:l,shapes:i,shapesBelow:r,custom:n,customBelow:o,autoPieces:a}}(e,i),a=b(()=>n.board.getBoundingClientRect()),l=e=>{var t;!function(e){let t,r,i,o,n,a,l,s,c,u,h="white"===e.orientation,d=y(e.dom.bounds()),p=e.dom.elements.board,g=e.pieces,m=e.animation.current,b=m?m.plan.anims:new Map,v=m?m.plan.fadings:new Map,_=e.draggable.current,w=function(e){let t=new Map;if(e.lastMove&&e.highlight.lastMove)for(let[r,i]of e.lastMove.entries())eY(t,1===r?eZ(e,i):i,"last-move");if(e.check&&e.highlight.check&&eY(t,e.check,"check"),e.selected&&(eY(t,e.selected,"selected"),e.movable.showDests)){for(let r of e.movable.dests?.get(e.selected)??[])eY(t,r,"move-dest"+(e.pieces.has(r)?" oc":""));for(let r of e.premovable.customDests?.get(e.selected)??e.premovable.dests??[])eY(t,r,"premove-dest"+(e.pieces.has(r)?" oc":""))}let r=e.premovable.current;if(r)for(let e of r)eY(t,e,"current-premove");else e.predroppable.current&&eY(t,e.predroppable.current.key,"current-premove");let i=e.exploding;if(i)for(let e of i.keys)eY(t,e,"exploding"+i.stage);return e.highlight.custom&&e.highlight.custom.forEach((e,r)=>{eY(t,r,e)}),t}(e),C=new Set,x=new Set,S=new Map,E=new Map;for(r=p.firstChild;r;){if(t=r.cgKey,eH(r))if(i=g.get(t),n=b.get(t),a=v.get(t),o=r.cgPiece,r.cgDragging&&(!_||_.orig!==t)&&(r.classList.remove("dragging"),k(r,d(f(t),h)),r.cgDragging=!1),!a&&r.cgFading&&(r.cgFading=!1,r.classList.remove("fading")),i){if(n&&r.cgAnimating&&o===eX(i)){let e=f(t);e[0]+=n[2],e[1]+=n[3],r.classList.add("anim"),k(r,d(e,h))}else r.cgAnimating&&(r.cgAnimating=!1,r.classList.remove("anim"),k(r,d(f(t),h)),e.addPieceZIndex&&(r.style.zIndex=eQ(f(t),h)));o!==eX(i)||a&&r.cgFading?a&&o===eX(a)?(r.classList.add("fading"),r.cgFading=!0):eJ(S,o,r):C.add(t)}else eJ(S,o,r);else if(eV(r)){let e=r.className;w.get(t)===e?x.add(t):eJ(E,e,r)}r=r.nextSibling}for(let[e,t]of w)if(!x.has(e)){u=(c=E.get(t))&&c.pop();let r=d(f(e),h);if(u)u.cgKey=e,k(u,r);else{let i=P("square",t);i.cgKey=e,k(i,r),p.insertBefore(i,p.firstChild)}}for(let[t,r]of g)if(n=b.get(t),!C.has(t))if(s=(l=S.get(eX(r)))&&l.pop()){s.cgKey=t,s.cgFading&&(s.classList.remove("fading"),s.cgFading=!1);let r=f(t);e.addPieceZIndex&&(s.style.zIndex=eQ(r,h)),n&&(s.cgAnimating=!0,s.classList.add("anim"),r[0]+=n[2],r[1]+=n[3]),k(s,d(r,h))}else{let i=eX(r),o=P("piece",i),a=f(t);o.cgPiece=i,o.cgKey=t,n&&(o.cgAnimating=!0,a[0]+=n[2],a[1]+=n[3]),k(o,d(a,h)),e.addPieceZIndex&&(o.style.zIndex=eQ(a,h)),p.appendChild(o)}for(let t of S.values())eG(e,t);for(let t of E.values())eG(e,t)}(d),n.autoPieces&&(t=n.autoPieces,function(e,t,r){let i=new Map,o=[];for(let t of e)i.set(t.hash,!1);let n=t.firstElementChild,a;for(;n;)a=n.getAttribute("cgHash"),i.has(a)?i.set(a,!0):o.push(n),n=n.nextElementSibling;for(let e of o)t.removeChild(e);for(let o of e)i.get(o.hash)||t.appendChild(r(o))}(d.drawable.autoShapes.filter(e=>e.piece).map(e=>{let t;return{shape:e,hash:[(t=e).orig,t.piece?.role,t.piece?.color,t.piece?.scale].join(","),current:!1,pendingErase:!1}}),t,e=>(function(e,{shape:t,hash:r},i){let o=t.orig,n=t.piece?.role,a=t.piece?.color,l=t.piece?.scale,s=P("piece",`${n} ${a}`);return s.setAttribute("cgHash",r),s.cgKey=o,s.cgScale=l,C(s,y(i)(f(o),"white"===e.orientation),l),s})(d,e,d.dom.bounds()))),!e&&n.shapes&&function(e,t){let r=e.drawable,i=r.current,o=i&&i.mouseSq?i:void 0,n=new Map,a=e.dom.bounds(),l=r.autoShapes.filter(e=>!e.piece);for(let t of r.shapes.concat(l).concat(o?[o]:[])){if(!t.dest)continue;let r=n.get(t.dest)??new Set,i=eq(e$(f(t.orig),e.orientation),a),o=eq(e$(f(t.dest),e.orientation),a);r.add(eK(i,o)),n.set(t.dest,r)}let s=[],c=o?r.shapes.findIndex(e=>ew(e,o)&&e.brush===o.brush):-1;for(let[e,t]of r.shapes.concat(l).entries()){let r=-1!==c&&c===e;s.push({shape:t,current:!1,pendingErase:r,hash:eA(t,eI(t.dest,n),!1,a,r)})}o&&-1===c&&s.push({shape:o,current:!0,hash:eA(o,eI(o.dest,n),!0,a,!1),pendingErase:!1});let u=s.map(e=>e.hash).join(";");u!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=u,function(e,t,r){for(let i of[r.shapes,r.shapesBelow]){let o=i.querySelector("defs"),n=t.filter(e=>i===r.shapesBelow==!!e.shape.below),a=new Map;for(let t of n.filter(e=>e.shape.dest&&e.shape.brush)){let r=ej(e.brushes[t.shape.brush],t.shape.modifiers),{key:i,color:o}=eR(t.shape);i&&o&&a.set(i,{key:i,color:o,opacity:1,lineWidth:1}),a.set(r.key,r)}let l=new Set,s=o.firstElementChild;for(;s;)l.add(s.getAttribute("cgKey")),s=s.nextElementSibling;for(let[e,t]of a.entries())l.has(e)||o.appendChild(function(e){let t=eL(eO("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(eL(eO("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}(t))}}(r,s,t),function(e,t,r){for(let[i,o]of[[t.shapes,t.custom],[t.shapesBelow,t.customBelow]]){let[n,a]=[i,o].map(e=>e.querySelector("g")),l=e.filter(e=>i===t.shapesBelow==!!e.shape.below),s=new Map;for(let e of l)s.set(e.hash,!1);for(let e of[n,a]){let t=[],r=e.firstElementChild,i;for(;r;)i=r.getAttribute("cgHash"),s.has(i)?s.set(i,!0):t.push(r),r=r.nextElementSibling;for(let r of t)e.removeChild(r)}for(let e of l.filter(e=>!s.get(e.hash)))for(let t of r(e))t.isCustom?a.appendChild(t.el):n.appendChild(t.el)}}(s,t,t=>(function(e,{shape:t,current:r,pendingErase:i,hash:o},n,a,l){var s,c,u,h,d,p,g,m,b,v,_;let w=eq(e$(f(t.orig),e.orientation),l),y=t.dest?eq(e$(f(t.dest),e.orientation),l):w,k=t.brush&&ej(n[t.brush],t.modifiers),C=a.get(t.dest),x=[];if(k){let e,p,f=eL(eO("g"),{cgHash:o});x.push({el:f}),w[0]!==y[0]||w[1]!==y[1]?f.appendChild(function(e,t,r,i,o,n,a){var l,s;let c;function u(l){var s,c;let u=(n&&!o?20:10)/64,h=i[0]-r[0],d=Math.atan2(i[1]-r[1],h),p=Math.cos(d)*u,f=Math.sin(d)*u,g=eR(e);return eL(eO("line"),{stroke:l?g.color:t.color,"stroke-width":(s=t,c=o,(s.lineWidth||10)*(c?.85:1)/64*(l?1.14:1)),"stroke-linecap":"round","marker-end":`url(#arrowhead-${l?g.key:t.key})`,opacity:e.modifiers?.hilite&&!a?1:eN(t,o,a),x1:r[0],y1:r[1],x2:i[0]-p,y2:i[1]-f})}if(!e.modifiers?.hilite)return u(!1);let h=eL(eO("g"),{opacity:t.opacity}),d=eL(eO("g"),{filter:"url(#cg-filter-blur)"});return d.appendChild((l=r,s=i,c={from:[Math.floor(Math.min(l[0],s[0])),Math.floor(Math.min(l[1],s[1]))],to:[Math.ceil(Math.max(l[0],s[0])),Math.ceil(Math.max(l[1],s[1]))]},eL(eO("rect"),{x:c.from[0],y:c.from[1],width:c.to[0]-c.from[0],height:c.to[1]-c.from[1],fill:"none",stroke:"none"}))),d.appendChild(u(!0)),h.appendChild(d),h.appendChild(u(!1)),h}(t,k,w,y,r,eI(t.dest,a),i)):f.appendChild((s=n[t.brush],c=w,u=r,h=l,d=i,e=[3/64,4/64],p=(h.width+h.height)/(4*Math.max(h.width,h.height)),eL(eO("circle"),{stroke:s.color,"stroke-width":e[+!u],fill:"none",opacity:eN(s,u,d),cx:c[0],cy:c[1],r:p-e[1]/2})))}if(t.label){let e,r,i,a,l,s=t.label;s.fill??(s.fill=t.brush&&n[t.brush].color);let c=t.brush?void 0:"tr";x.push({el:(p=s,g=o,m=w,b=y,v=C,_=c,e=.4*.75**p.text.length,r=eD(m,b,v),i=.4*("tr"===_),(a=eL(eO("g"),{transform:`translate(${r[0]+i},${r[1]-i})`,cgHash:g})).appendChild(eL(eO("circle"),{r:.2,"fill-opacity":_?1:.8,"stroke-opacity":_?1:.7,"stroke-width":.03,fill:p.fill??"#666",stroke:"white"})),(l=eL(eO("text"),{"font-size":e,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**p.text.length})).innerHTML=p.text,a.appendChild(l),a),isCustom:!0})}if(t.customSvg){let e=t.customSvg.center??"orig",[r,i]="label"===e?eD(w,y,C).map(e=>e-.5):"dest"===e?y:w,n=eL(eO("g"),{transform:`translate(${r},${i})`,cgHash:o});n.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,x.push({el:n,isCustom:!0})}return x})(e,t,r.brushes,n,a)))}(d,n)},h=()=>{eU(d);let e="white"===d.orientation,t=y(d.dom.bounds()),r=d.dom.elements.board.firstChild;for(;r;)(eH(r)&&!r.cgAnimating||eV(r))&&k(r,t(f(r.cgKey),e)),r=r.nextSibling;n.autoPieces&&function(e){let t="white"===e.orientation,r=y(e.dom.bounds()),i=e.dom.elements.autoPieces?.firstChild;for(;i;)C(i,r(f(i.cgKey),t),i.cgScale),i=i.nextSibling}(d)},d=i;return d.dom={elements:n,bounds:a,redraw:(t=l,r=!1,()=>{r||(r=!0,requestAnimationFrame(()=>{t(),r=!1}))}),redrawNow:l,unbind:o},d.drawable.prevSvgHash="",eU(d),l(!1),!function(e,t){let r,i=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&i.addEventListener("contextmenu",e=>e.preventDefault()),e.viewOnly)return;let o=(r=e,e=>{r.draggable.current?eS(r):r.drawable.current?e_(r):e.shiftKey||M(e)?r.drawable.enabled&&function(e,t){var r;if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?G(e):ee(e);let i=S(t),o=er(i,"white"===e.orientation,e.dom.bounds());o&&(e.drawable.current={orig:o,pos:i,brush:em[+!!(((r=t).shiftKey||r.ctrlKey)&&M(r))+2*!!(r.altKey||r.metaKey||r.getModifierState?.("AltGraph"))],snapToValidMove:e.drawable.defaultSnapToValidMove},function e(t){requestAnimationFrame(()=>{let r=t.drawable.current;if(r){let i=er(r.pos,"white"===t.orientation,t.dom.bounds());i||(r.snapToValidMove=!1);let o=r.snapToValidMove?function(e,t,r,i){let o=f(e),n=g.filter(e=>{let t,r,i,n;return o[0]===e[0]&&o[1]===e[1]||(t=o[0],I(t,r=o[1],i=e[0],n=e[1])||O(t,r,i,n))||$(o[0],o[1],e[0],e[1])}),a=n.map(e=>A(p(e),r,i)).map(e=>_(t,e)),[,l]=a.reduce((e,t,r)=>e[0]<t?e:[t,r],[a[0],0]);return p(n[l])}(r.orig,r.pos,"white"===t.orientation,t.dom.bounds()):i;o!==r.mouseSq&&(r.mouseSq=o,r.dest=o!==r.orig?o:void 0,t.dom.redrawNow()),e(t)}})}(e))}(r,e):r.viewOnly||(r.dropmode.active?function(e,t){if(!e.dropmode.active)return;K(e),D(e);let r=e.dropmode.piece;if(r){e.pieces.set("a0",r);let i=S(t),o=i&&er(i,"white"===e.orientation,e.dom.bounds());o&&U(e,"a0",o)}e.dom.redraw()}(r,e):function(e,t){let r;if(!(e.trustAllEvents||t.isTrusted)||void 0!==t.buttons&&t.buttons>1||t.touches&&t.touches.length>1)return;let i=e.dom.bounds(),o=S(t),n=er(o,"white"===e.orientation,i);if(!n)return;let a=e.pieces.get(n),l=e.selected;if(!l&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!a||a.color!==e.turnColor)&&e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),ey(e.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||a||l||function(e,t){let r="white"===e.orientation,i=e.dom.bounds(),o=2*Math.pow(e.touchIgnoreRadius*i.width/16,2);for(let n of e.pieces.keys())if(_(A(n,r,i),t)<=o)return!0;return!1}(e,o)))t.preventDefault();else if(t.touches)return;let s=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&X(e,e.selected,n)?eh(e=>H(e,n),e):H(e,n);let u=e.selected===n,h=eM(e,n);if(a&&h&&u&&(r=e.pieces.get(n))&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))){e.draggable.current={orig:n,piece:a,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:l,originTarget:t.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");let r=e.dom.elements.ghost;r&&(r.className=`ghost ${a.color} ${a.role}`,k(r,y(i)(f(n),"white"===e.orientation)),x(r,!0)),ek(e)}else s&&K(e),c&&D(e);e.dom.redraw()}(r,e))});i.addEventListener("touchstart",o,{passive:!1}),i.addEventListener("mousedown",o,{passive:!1})}(d,h),o||(d.dom.unbind=function(e,t){let r=[];if("ResizeObserver"in window||r.push(ez(document.body,"chessground.resize",t)),!e.viewOnly){let t=eW(e,eC,eb),i=eW(e,ex,ev);for(let e of["touchmove","mousemove"])r.push(ez(document,e,t));for(let e of["touchend","mouseup"])r.push(ez(document,e,i));let o=()=>e.dom.bounds.clear();r.push(ez(document,"scroll",o,{capture:!0,passive:!0})),r.push(ez(window,"resize",o,{passive:!0}))}return()=>r.forEach(e=>e())}(d,h)),d.events.insert&&d.events.insert(n),d}es(i,t||{});var n=o();function a(){n.orientation=v(n.orientation),n.animation.current=n.draggable.current=n.selected=void 0,o()}return{set(e){e.orientation&&e.orientation!==n.orientation&&a(),el(n,e),(e.fen?eh:ed)(t=>es(t,e),n)},state:n,getFen:()=>{var e;return e=n.pieces,h.map(t=>c.map(r=>{let i=e.get(r+t);if(!i)return"1";{let e=en[i.role];return"white"===i.color&&(e=e.toUpperCase()),i.promoted&&(e+="~"),e}}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())},toggleOrientation:a,setPieces(e){eh(t=>(function(e,t){for(let[r,i]of t)i?e.pieces.set(r,i):e.pieces.delete(r)})(t,e),n)},selectSquare(e,t){e?eh(r=>H(r,e,t),n):n.selected&&(G(n),n.dom.redraw())},move(e,t){eh(r=>F(r,e,t),n)},newPiece(e,t){eh(r=>B(r,e,t),n)},playPremove(){if(n.premovable.current){if(eh(J,n))return!0;n.dom.redraw()}return!1},playPredrop(e){if(n.predroppable.current){let t=function(e,t){let r=e.predroppable.current,i=!1;if(!r)return!1;if(t(r)){let t={role:r.role,color:e.movable.color};B(e,t,r.key)&&(q(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),i=!0)}return D(e),i}(n,e);return n.dom.redraw(),t}return!1},cancelPremove(){ed(K,n)},cancelPredrop(){ed(D,n)},cancelMove(){ed(e=>{ee(e),eS(e)},n)},stop(){ed(e=>{et(e),eS(e)},n)},explode(e){n.exploding={stage:1,keys:e},n.dom.redraw(),setTimeout(()=>{eP(n,2),setTimeout(()=>eP(n,void 0),120)},120)},setAutoShapes(e){ed(t=>t.drawable.autoShapes=e,n)},setShapes(e){ed(t=>t.drawable.shapes=e.slice(),n)},getKeyAtDomPos:e=>er(e,"white"===n.orientation,n.dom.bounds()),redrawAll:o,dragNewPiece(e,t,r){let i;n.pieces.set("a0",e),n.dom.redraw(),i=S(t),n.draggable.current={orig:"a0",piece:e,origPos:i,pos:i,started:!0,element:()=>eM(n,"a0"),originTarget:t.target,newPiece:!0,force:!!r,keyHasChanged:!1},ek(n)},destroy(){et(n),n.dom.unbind&&n.dom.unbind(),n.dom.destroyed=!0}}}(e5.current,{fen:R.fen(),turnColor:eo,orientation:Z||"white",movable:{color:tt||tr?Z:null,free:!1,dests:tt?ti():new Map,events:{after:tn}},draggable:{showGhost:!0,deleteOnDropOff:!0},animation:{enabled:!0,duration:300},highlight:{lastMove:!0,check:!0},premovable:{enabled:!1},drawable:{enabled:!0}})),()=>{e7.current&&(e7.current.destroy(),e7.current=null,e9.current=!1)}),[]),(0,l.useEffect)(()=>{if(!e7.current)return;let e=to();e7.current.set({fen:R.fen(),turnColor:eo,orientation:Z||"white",movable:{color:!e.gameOver&&tt&&tr?Z:null,free:!1,dests:e.gameOver||!tt?new Map:ti(),events:{after:tn}},check:e.isCheck,lastMove:eu,animation:{enabled:!0,duration:300}}),eg(e),e.gameOver&&"finished"!==z.status&&a.emit("game over",{gameId:d,login:t.login,token:t.token}),"finished"===z.status&&e4(!0)},[R,eo,tt,tr,Z,eu,to,ti,tn]),(0,l.useEffect)(()=>{let e=e=>{if(d in e){L&&j(!1),E&&T(!1);let t=e[d];if(W(t),t.pgn!==V&&t.pgn.length>V.length){Q(t.pgn);let e=new tk;e.loadPgn(t.pgn);let r=e.history({verbose:!0});if(r.length>0){let e=r[r.length-1];ep([e.from,e.to])}N(e)}}else m?E||T(!0):L||j(!0)};return a.on("list of games",e),()=>{a.off("list of games",e)}},[a,d,V,m]),(0,l.useEffect)(()=>{if(V){let e=new tk;try{e.loadPgn(V),N(e)}catch(e){console.error("Error loading PGN:",e)}}},[V]),L)?(0,r.jsx)(tx.Backdrop,{sx:e=>({color:"#fff",zIndex:e.zIndex.drawer+1}),open:!0,children:(0,r.jsxs)(tS.Box,{sx:{display:"flex",alignItems:"center",flexDirection:"column",gap:"24px"},children:[(0,r.jsxs)(ra.Stack,{spacing:2,direction:"column",sx:{p:3},children:[(0,r.jsx)(rl.Typography,{variant:"h6",children:(0,rE.default)("errorLoadingPageTitle",t.language)}),(0,r.jsx)(rl.Typography,{variant:"subtitle1",children:(0,rE.default)("errorLoadingPageDescription",t.language)})]}),(0,r.jsxs)(ra.Stack,{spacing:2,direction:"column",children:[(0,r.jsx)(tE.Button,{variant:"contained",onClick:()=>e.push("/"),children:(0,rE.default)("toMainPage",t.language)}),(0,r.jsx)(tE.Button,{variant:"outlined",onClick:e=>void window.location.reload(),children:(0,rE.default)("reload",t.language)})]})]})}):(0,r.jsxs)(n.ThemeProvider,{theme:rL,defaultMode:"dark",noSsr:!0,children:[(0,r.jsx)(tx.Backdrop,{sx:e=>({color:"#fff",zIndex:e.zIndex.drawer+1}),open:E,children:(0,r.jsx)(tV.CircularProgress,{disableShrink:!0,color:"inherit"})}),(0,r.jsx)(tS.Box,{sx:{width:"100%"},children:(0,r.jsx)(rd.default,{type:"game",gameId:d,gameInfo:z,handleSetIsUserLeftGame:e=>{w(!0),m!==e&&w(e)}})}),(!t.login||!Z)&&!E&&(0,r.jsx)(tS.Box,{sx:{width:"100%"},children:(0,r.jsx)(tC.Alert,{severity:"info",sx:{m:1},variant:"outlined",icon:(0,r.jsx)(rc.default,{fontSize:"inherit"}),children:(0,rE.default)("spectatorMode",t.language)})}),(0,r.jsx)(tS.Box,{sx:{p:1},display:"flex",justifyContent:"start",children:(0,r.jsxs)(ra.Stack,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[("white"===Z&&"b"===R.turn()||"black"===Z&&"w"===R.turn())&&"finished"!==z.status?z.players?.black?(0,r.jsx)(rs.default,{size:16,color:"success",sx:{width:"16px",height:"16px"}}):(0,r.jsx)(tV.CircularProgress,{size:"1em",color:""}):z.players?.black?(0,r.jsx)(rs.default,{size:16,color:"success",sx:{width:"16px",height:"16px"}}):(0,r.jsx)(rs.default,{size:16,color:"disabled",sx:{width:"16px",height:"16px"}}),(0,r.jsx)(rl.Typography,{variant:"body1",sx:{color:"rgb(186, 186, 186)",fontWeight:"bold"},children:"black"===Z?z.players?.white?z.players.white:"finished"===z.status?(0,r.jsx)(r.Fragment,{children:R.getHeaders()?.White?R.getHeaders()?.White:""}):(0,r.jsx)(r.Fragment,{children:(0,rE.default)("waitingForOpponent",t.language)}):z.players?.black?"Computer"===z.players.black?(0,r.jsx)(r.Fragment,{children:(0,rE.default)("computer",t.language)}):z.players.black:"finished"===z.status?(0,r.jsx)(r.Fragment,{children:R.getHeaders()?.Black?R.getHeaders()?.Black:""}):(0,r.jsx)(r.Fragment,{children:(0,rE.default)("waitingForOpponent",t.language)})}),("white"===Z&&"b"===R.turn()||"black"===Z&&"w"===R.turn())&&"finished"!==z.status?(0,r.jsx)(tH,{label:(0,rE.default)("waitingForOpponent",t.language),size:"small",variant:"outlined"}):"finished"===z.status?("white"!==Z||z.players.black)&&("black"!==Z||z.players.white)?"":(0,r.jsx)(tH,{label:(0,rE.default)("opponentLeftTheGame",t.language),size:"small",variant:"outlined"}):""]})}),(0,r.jsx)(tS.Box,{sx:{width:"100%"},children:(0,r.jsx)("div",{ref:e5})}),(0,r.jsx)(tS.Box,{sx:{p:1},display:"flex",justifyContent:"start",children:(0,r.jsxs)(ra.Stack,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[(0,r.jsx)(rs.default,{size:16,color:"success",sx:{width:"16px",height:"16px"}}),(0,r.jsx)(rl.Typography,{variant:"body1",sx:{color:"rgb(186, 186, 186)",fontWeight:"bold"},children:"white"===Z?z.players.white:"black"===Z?z.players?.black:z.players?.white||""}),"white"===Z&&"w"===R.turn()||"black"===Z&&"b"===R.turn()?(0,r.jsx)(tH,{label:(0,rE.default)("yourTurn",t.language),size:"small",variant:"outlined"}):""]})}),(0,r.jsx)(tS.Box,{sx:{width:"100%",p:1},children:(0,r.jsx)(tG.Paper,{sx:{width:"100%",overflow:"hidden",p:1,textAlign:"center"},children:ef&&!ef.gameOver&&"finished"!==z.status?ef.status:ef?.gameOver?(z.status,ef.status):"finished"===z.status?z.players.black?`${(0,rE.default)("whiteLeftTheGame",t.language)}`:`${(0,rE.default)("blackLeftTheGame",t.language)}`:ef?.status})}),(0,r.jsx)(tS.Box,{sx:{width:"100%",p:1},children:(0,r.jsx)(rP,{pgn:V,fen:R.fen()})}),(0,r.jsx)(rn,{open:e8,autoHideDuration:6e3,onClose:e3,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,r.jsx)(tC.Alert,{onClose:e3,severity:"info",variant:"filled",sx:{width:"100%"},children:z?.result?.startsWith("black")?(0,r.jsx)(r.Fragment,{children:(0,rE.default)("blackWinsGame",t.language)}):z?.result?.startsWith("white")?(0,r.jsx)(r.Fragment,{children:(0,rE.default)("whiteWinsGame",t.language)}):z?.result?.startsWith("draw")?(0,r.jsx)(r.Fragment,{children:(0,rE.default)("draw",t.language)}):ef?.status})})]})}e.s(["default",0,function(e){let t,o,n=(0,i.c)(3),{children:a}=e;return n[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,r.jsx)(rO.default,{}),n[0]=t):t=n[0],n[1]!==a?(o=(0,r.jsx)(l.Suspense,{fallback:t,children:(0,r.jsx)(rR,{children:a})}),n[1]=a,n[2]=o):o=n[2],o}],70486)}]);